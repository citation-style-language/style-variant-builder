<?xml version="1.0" encoding="utf-8"?>
<?xml-model href="https://raw.githubusercontent.com/citation-style-language/schema/refs/heads/master/schemas/styles/csl-repository.rnc"
  type="application/relax-ng-compact-syntax" schematypens="http://relaxng.org/ns/compatibility/annotations/1.0"?>
<?xml-model href="https://raw.githubusercontent.com/citation-style-language/schema/refs/heads/master/schemas/styles/csl-repository.rnc"
  type="application/relax-ng-compact-syntax" schematypens="http://purl.oclc.org/dsdl/schematron"?>
<style and="text" class="note" default-locale="en-GB" demote-non-dropping-particle="display-and-sort" et-al-min="4" et-al-use-first="1" page-range-format="chicago-16" version="1.0" xmlns="http://purl.org/net/xbiblio/csl">
  <info>
    <title>New Hart's Rules: The Oxford Style Guide 2nd edition (template)</title>
    <title-short>NHR (template)</title-short>
    <id>http://www.zotero.org/styles/new-harts-rules-notes</id>
    <link href="http://www.zotero.org/styles/new-harts-rules-notes" rel="self"/>
    <link href="https://en.wikipedia.org/wiki/Hart's_Rules" rel="documentation"/>
    <author>
      <name>Andrew Dunning</name>
      <uri>https://orcid.org/0000-0003-0464-5036</uri>
    </author>
    <category citation-format="note"/>
    <category field="anthropology"/>
    <category field="communications"/>
    <category field="generic-base"/>
    <category field="geography"/>
    <category field="history"/>
    <category field="humanities"/>
    <category field="linguistics"/>
    <category field="literature"/>
    <category field="philosophy"/>
    <category field="political_science"/>
    <category field="psychology"/>
    <category field="science"/>
    <category field="social_science"/>
    <category field="sociology"/>
    <category field="theology"/>
    <summary>Oxford source citations, template</summary>
    <updated>2025-07-15T00:00:00+00:00</updated>
    <rights license="http://creativecommons.org/licenses/by-sa/3.0/">This work is licensed under a Creative Commons Attribution-ShareAlike 3.0 License</rights>
  </info>
  <locale xml:lang="en">
    <date form="text">
      <date-part name="day" suffix=" "/>
      <date-part form="short" name="month" suffix=" "/>
      <date-part name="year"/>
    </date>
    <terms>
      <!-- Like Chicago, Oxford omits 'by' from `verb-short` forms; it abbreviates only the most common roles -->
      <term name="advance-online-publication">published online</term>
      <term form="verb-short" name="collection-editor">ed.</term>
      <term form="verb-short" name="compiler">comp.</term>
      <term form="verb-short" name="editor">ed.</term>
      <term form="short" name="editor-translator">
        <single>ed. and trans.</single>
        <multiple>eds and trans.</multiple>
      </term>
      <term form="short" name="editortranslator">
        <single>ed. and trans.</single>
        <multiple>eds and trans.</multiple>
      </term>
      <term form="verb-short" name="editor-translator">ed. and trans.</term>
      <term form="verb-short" name="editortranslator">ed. and trans.</term>
      <term form="verb-short" name="illustrator">illus.</term>
      <term name="manuscript">unpublished manuscript</term>
      <term form="short" name="paper-conference">paper</term>
      <term form="verb-short" name="translator">trans.</term>
    </terms>
  </locale>
  <!-- This file's main source is the New Oxford Style Manual (2016), with reference also to the Oxford Style Manual (2003) <https://archive.org/details/oxfordstylemanua0000unse>, which provides more detailed guidance on many points. -->
  <!-- Contents:
    
       This file interprets New Hart's Rules using APA's four basic reference elements:

        1. Author
        2. Date (author-date system only)
        3. Title and descriptions
            3.1. Title
            3.2. Description
            3.3. Identifiers (contributors, edition, volume)
        4. Source
            4.1. Serial sources
            4.2. Monographic sources
            4.3. Series
            4.4. Event
            4.5. Publisher
            4.6. Date
            4.7. Locator (including page references)
            4.8. Medium
            4.9. Archival location
            4.10. URL or persistent identifier
       
       Freeform annotations to bibliography entries: 
        
        5. Notes
       
       Legal references (NHR 13) use OSCOLA:

        6. Legal references
  -->
  <!-- Categories of CSL item types:

       Serial
       : article-journal article-magazine article-newspaper periodical post-weblog review review-book

       Serial or Monographic
       : interview paper-conference

         Monographic with any of `collection-editor compiler editor editorial-director`.
         A serial `paper-conference` is unpublished if it lacks any of `issue page supplement-number volume`.

       Monographic
       : article book broadcast chapter classic collection dataset document
         entry entry-dictionary entry-encyclopedia event figure
         graphic manuscript map motion_picture musical_score
         pamphlet patent performance personal_communication post report
         software song speech standard thesis webpage

       Legal
       : bill hearing legal_case legislation regulation treaty
  -->
  <!-- Variable labels -->
  <macro name="label-chapter-number">
    <group delimiter=" ">
      <choose>
        <if is-numeric="chapter-number" type="song">
          <text value="track"/>
        </if>
        <else-if is-numeric="chapter-number">
          <label form="short" variable="chapter-number"/>
        </else-if>
      </choose>
      <text variable="chapter-number"/>
    </group>
  </macro>
  <macro name="label-chapter-number-capitalized">
    <group delimiter=" ">
      <choose>
        <if is-numeric="chapter-number" type="song">
          <text text-case="capitalize-first" value="track"/>
        </if>
        <else-if is-numeric="chapter-number">
          <label form="short" text-case="capitalize-first" variable="chapter-number"/>
        </else-if>
      </choose>
      <text text-case="capitalize-first" variable="chapter-number"/>
    </group>
  </macro>
  <macro name="label-chapter-number-long">
    <group delimiter=" ">
      <choose>
        <if is-numeric="chapter-number" type="song">
          <text value="track"/>
        </if>
        <else-if is-numeric="chapter-number">
          <label variable="chapter-number"/>
        </else-if>
      </choose>
      <text variable="chapter-number"/>
    </group>
  </macro>
  <macro name="label-edition">
    <group delimiter=" ">
      <choose>
        <if is-numeric="edition">
          <number form="ordinal" variable="edition"/>
          <label form="short" variable="edition"/>
        </if>
        <else-if match="any" type="article-journal article-magazine article-newspaper periodical post-weblog review review-book">
          <!-- full label for serial edition (cf. CMOS18 14.89) -->
          <text variable="edition"/>
          <label variable="edition"/>
        </else-if>
        <else-if match="any" type="interview paper-conference">
          <choose>
            <if match="any" variable="collection-editor compiler editor editorial-director">
              <!-- monographic usage -->
              <text variable="edition"/>
            </if>
            <else>
              <!-- serial usage -->
              <text variable="edition"/>
              <label variable="edition"/>
            </else>
          </choose>
        </else-if>
        <else>
          <text variable="edition"/>
        </else>
      </choose>
    </group>
  </macro>
  <macro name="label-edition-capitalized">
    <group delimiter=" ">
      <choose>
        <if is-numeric="edition">
          <number form="ordinal" variable="edition"/>
          <label form="short" variable="edition"/>
        </if>
        <else-if match="any" type="article-journal article-magazine article-newspaper periodical post-weblog review review-book">
          <!-- full label for serial edition (cf. CMOS18 14.89) -->
          <text text-case="title" variable="edition"/>
          <label text-case="capitalize-first" variable="edition"/>
        </else-if>
        <else-if match="any" type="interview paper-conference">
          <choose>
            <if match="any" variable="collection-editor compiler editor editorial-director">
              <!-- monographic usage -->
              <text text-case="capitalize-first" variable="edition"/>
            </if>
            <else>
              <!-- serial usage -->
              <text text-case="title" variable="edition"/>
              <label text-case="capitalize-first" variable="edition"/>
            </else>
          </choose>
        </else-if>
        <else>
          <text text-case="capitalize-first" variable="edition"/>
        </else>
      </choose>
    </group>
  </macro>
  <macro name="label-issue">
    <group delimiter=" ">
      <label form="short" variable="issue"/>
      <text variable="issue"/>
    </group>
  </macro>
  <macro name="label-locator">
    <group delimiter=" ">
      <choose>
        <if locator="page"/>
        <else-if is-numeric="locator">
          <label form="short" variable="locator"/>
        </else-if>
        <!-- a non-numeric canonical reference is described by its formatting and does not need a label, similar to a timestamp (NHR 17.2.5) -->
        <else-if locator="chapter line verse" match="any"/>
        <else>
          <label form="short" variable="locator"/>
        </else>
      </choose>
      <text variable="locator"/>
    </group>
  </macro>
  <macro name="label-locator-all">
    <group delimiter=" ">
      <choose>
        <if is-numeric="locator">
          <label form="short" variable="locator"/>
        </if>
        <!-- a non-numeric canonical reference is described by its formatting and does not need a label, similar to a timestamp (NHR 17.2.5) -->
        <else-if locator="chapter line verse" match="any"/>
        <else>
          <label form="short" variable="locator"/>
        </else>
      </choose>
      <text variable="locator"/>
    </group>
  </macro>
  <macro name="label-number">
    <group delimiter=" ">
      <choose>
        <if type="standard"/>
        <else-if is-numeric="number">
          <label form="short" variable="number"/>
        </else-if>
      </choose>
      <text variable="number"/>
    </group>
  </macro>
  <macro name="label-number-article">
    <group delimiter=" ">
      <choose>
        <if is-numeric="number">
          <text form="short" term="article-locator"/>
        </if>
      </choose>
      <text variable="number"/>
    </group>
  </macro>
  <macro name="label-number-of-volumes">
    <group delimiter=" ">
      <text variable="number-of-volumes"/>
      <choose>
        <if is-numeric="number-of-volumes">
          <label form="short" variable="number-of-volumes"/>
        </if>
      </choose>
    </group>
  </macro>
  <macro name="label-page">
    <group delimiter=" ">
      <label form="short" variable="page"/>
      <text variable="page"/>
    </group>
  </macro>
  <macro name="label-part-number">
    <group delimiter=" ">
      <choose>
        <if is-numeric="part-number">
          <!-- TODO: Replace with `part-number` label when CSL provides one -->
          <text form="short" term="part"/>
        </if>
      </choose>
      <text variable="part-number"/>
    </group>
  </macro>
  <macro name="label-section">
    <group delimiter=" ">
      <choose>
        <if is-numeric="section">
          <label variable="section"/>
        </if>
      </choose>
      <text text-case="title" variable="section"/>
    </group>
  </macro>
  <macro name="label-section-capitalized">
    <group delimiter=" ">
      <choose>
        <if is-numeric="section">
          <label text-case="capitalize-first" variable="section"/>
        </if>
      </choose>
      <text text-case="title" variable="section"/>
    </group>
  </macro>
  <macro name="label-section-symbol">
    <group delimiter=" ">
      <label form="symbol" variable="section"/>
      <text variable="section"/>
    </group>
  </macro>
  <macro name="label-supplement-number">
    <group delimiter=" ">
      <choose>
        <!-- TODO: Replace with `supplement-number` label when CSL provides one -->
        <if is-numeric="supplement-number" variable="volume-title">
          <!-- if there is a volume title, it is already described as a supplement -->
          <text form="short" term="issue"/>
        </if>
        <else-if is-numeric="supplement-number" type="periodical" variable="title">
          <text form="short" term="issue"/>
        </else-if>
        <else-if is-numeric="supplement-number">
          <text form="short" term="supplement"/>
        </else-if>
      </choose>
      <text variable="supplement-number"/>
    </group>
  </macro>
  <macro name="label-version">
    <group delimiter=" ">
      <label variable="version"/>
      <text variable="version"/>
    </group>
  </macro>
  <macro name="label-version-capitalized">
    <group delimiter=" ">
      <label text-case="capitalize-first" variable="version"/>
      <text variable="version"/>
    </group>
  </macro>
  <macro name="label-volume">
    <!-- label a volume by rendering it in Roman numerals (NHR 18.2.7) -->
    <choose>
      <if is-numeric="volume">
        <number form="roman" variable="volume"/>
      </if>
      <else>
        <text variable="volume"/>
      </else>
    </choose>
  </macro>
  <!-- 1. Author -->
  <macro name="author-bib">
    <group delimiter=", ">
      <names variable="composer">
        <name delimiter-precedes-et-al="after-inverted-name" delimiter-precedes-last="always" name-as-sort-order="first"/>
        <!-- for OGS: -->
        <!-- <name delimiter-precedes-et-al="after-inverted-name" delimiter-precedes-last="always" font-variant="small-caps" name-as-sort-order="first"/> -->
        <!-- <et-al font-variant="normal"/> -->
        <label form="short" prefix=", "/>
        <substitute>
          <names variable="author"/>
          <names variable="host"/>
          <names variable="guest"/>
          <choose>
            <if type="song">
              <names variable="performer"/>
            </if>
          </choose>
          <choose>
            <if type="classic">
              <!-- editors in author position only for an edited collection (NHR 18.2.2) -->
              <text macro="author-title-substitute"/>
            </if>
          </choose>
          <names variable="illustrator"/>
          <choose>
            <if match="none" type="standard">
              <names variable="editor-translator"/>
              <names variable="editor"/>
              <names variable="translator"/>
              <names variable="collection-editor"/>
            </if>
          </choose>
          <names variable="director"/>
          <names variable="producer"/>
          <names variable="executive-producer"/>
          <names variable="series-creator"/>
          <names variable="editorial-director"/>
          <names variable="compiler"/>
          <choose>
            <if match="any" type="event performance speech">
              <names variable="chair"/>
              <names variable="organizer"/>
            </if>
          </choose>
          <names variable="curator"/>
          <choose>
            <if type="software">
              <!-- `software` listed under the name of the publisher or developer (NHR 18.8.5) -->
              <text variable="publisher"/>
            </if>
            <else-if type="standard">
              <!-- `standard` listed in bibliography under organization, but note omits this (cf. CMOS18 14.159) -->
              <text variable="authority"/>
            </else-if>
          </choose>
          <text macro="author-title-substitute"/>
          <choose>
            <if type="manuscript">
              <choose>
                <if match="none" variable="container-title event-date event-place event-title genre title publisher publisher-place">
                  <text macro="source-archive"/>
                </if>
              </choose>
            </if>
          </choose>
        </substitute>
      </names>
    </group>
  </macro>
  <macro name="author-inline">
    <choose>
      <if match="any" type="interview personal_communication">
        <text macro="author-short-and-recipient"/>
      </if>
      <else>
        <names variable="composer">
          <name form="short" initialize-with=". "/>
          <substitute>
            <names variable="author"/>
            <names variable="host"/>
            <names variable="guest"/>
            <choose>
              <if type="song">
                <names variable="performer"/>
              </if>
            </choose>
            <choose>
              <if type="classic">
                <!-- editors in author position only for an edited collection (cf. NHR 17.2.5, MHRA4 8.3) -->
                <text macro="author-title-substitute-short"/>
              </if>
            </choose>
            <names variable="illustrator"/>
            <choose>
              <if match="none" type="standard">
                <names variable="editor-translator"/>
                <names variable="editor"/>
                <names variable="translator"/>
                <names variable="collection-editor"/>
              </if>
            </choose>
            <names variable="director"/>
            <names variable="producer"/>
            <names variable="executive-producer"/>
            <names variable="series-creator"/>
            <names variable="editorial-director"/>
            <names variable="compiler"/>
            <choose>
              <if match="any" type="event performance speech">
                <names variable="chair"/>
                <names variable="organizer"/>
              </if>
            </choose>
            <names variable="curator"/>
            <choose>
              <if type="software">
                <!-- `software` listed under the name of the publisher or developer (NHR 18.8.5) -->
                <text variable="publisher"/>
              </if>
              <else-if type="standard">
                <!-- `standard` listed in bibliography under organization, but note omits this (cf. CMOS18 14.159) -->
                <text variable="authority"/>
              </else-if>
            </choose>
            <text macro="author-title-substitute-short"/>
            <choose>
              <if type="manuscript">
                <choose>
                  <if match="none" variable="container-title event-date event-place event-title genre title publisher publisher-place">
                    <text macro="source-archive-short"/>
                  </if>
                </choose>
              </if>
            </choose>
          </substitute>
        </names>
      </else>
    </choose>
  </macro>
  <macro name="author-note">
    <group delimiter=", ">
      <names variable="composer">
        <name delimiter-precedes-last="contextual"/>
        <label form="short" prefix=", "/>
        <substitute>
          <names variable="author"/>
          <names variable="guest"/>
          <names variable="host"/>
          <choose>
            <if type="song">
              <names variable="performer"/>
            </if>
          </choose>
          <choose>
            <if match="any" type="classic performance">
              <!-- note contributors fall after the title of `classic` (cf. CMOS18 14.147), `performance` (cf. CMOS18 14.166) -->
              <text macro="author-title-substitute"/>
            </if>
          </choose>
          <names variable="illustrator"/>
          <choose>
            <!-- In multivolume works, notes list editors after the title of the part for which they are responsible (cf. CMOS18 14.20–24); it appears also that editors should not be substituted for authors with chapters (cf. CMOS18 14.22) -->
            <if match="any" type="chapter standard" variable="part-title volume-title"/>
            <else-if type="book" variable="container-title"/>
            <else>
              <names variable="editor-translator"/>
              <names variable="editor"/>
              <names variable="translator"/>
              <names variable="collection-editor"/>
            </else>
          </choose>
          <names variable="director"/>
          <choose>
            <!-- serial `broadcast` prioritizes title (cf. CMOS18 14.165, 14.168) -->
            <if type="broadcast" variable="container-title number title"/>
            <else>
              <names variable="producer"/>
              <names variable="executive-producer"/>
              <names variable="series-creator"/>
              <choose>
                <if type="broadcast">
                  <names variable="contributor"/>
                </if>
              </choose>
            </else>
          </choose>
          <names variable="editorial-director"/>
          <names variable="compiler"/>
          <choose>
            <if match="any" type="event performance speech">
              <names variable="chair"/>
              <names variable="organizer"/>
            </if>
          </choose>
          <names variable="curator"/>
          <choose>
            <if type="software">
              <!-- `software` listed under the name of the publisher or developer (NHR 18.8.5) -->
              <text variable="publisher"/>
            </if>
            <else-if type="standard">
              <!-- `standard` listed in bibliography under organization (cf. CMOS18 14.159) -->
              <text variable="authority"/>
            </else-if>
          </choose>
          <choose>
            <if type="manuscript">
              <choose>
                <if match="none" variable="container-title event-date event-place event-title genre title publisher publisher-place">
                  <text macro="source-archive"/>
                </if>
              </choose>
            </if>
          </choose>
        </substitute>
      </names>
    </group>
  </macro>
  <macro name="author-short">
    <choose>
      <if match="any" type="interview personal_communication">
        <text macro="author-short-and-recipient"/>
      </if>
      <else>
        <names variable="composer">
          <name form="short"/>
          <substitute>
            <names variable="author"/>
            <names variable="guest"/>
            <names variable="host"/>
            <choose>
              <if type="song">
                <names variable="performer"/>
              </if>
            </choose>
            <choose>
              <if match="any" type="classic performance">
                <!-- note contributors fall after the title of `classic` (cf. CMOS18 14.147), `performance` (cf. CMOS18 14.166) -->
                <text macro="author-title-substitute-short"/>
              </if>
            </choose>
            <names variable="illustrator"/>
            <choose>
              <!-- In multivolume works, notes list editors after the title of the part for which they are responsible (cf. CMOS18 14.20–24); it appears also that editors should not be substituted for authors with chapters (cf. CMOS18 14.22) -->
              <if match="any" type="chapter standard" variable="part-title volume-title"/>
              <else-if type="book" variable="container-title"/>
              <else>
                <names variable="editor-translator"/>
                <names variable="editor"/>
                <names variable="translator"/>
                <names variable="collection-editor"/>
              </else>
            </choose>
            <names variable="director"/>
            <choose>
              <!-- serial `broadcast` prioritizes title (cf. CMOS18 14.165, 14.168) -->
              <if type="broadcast" variable="container-title number title"/>
              <else>
                <names variable="producer"/>
                <names variable="executive-producer"/>
                <names variable="series-creator"/>
                <choose>
                  <if type="broadcast">
                    <names variable="contributor"/>
                  </if>
                </choose>
              </else>
            </choose>
            <names variable="editorial-director"/>
            <names variable="compiler"/>
            <choose>
              <if match="any" type="event performance speech">
                <names variable="chair"/>
                <names variable="organizer"/>
              </if>
            </choose>
            <names variable="curator"/>
            <choose>
              <if type="software">
                <!-- `software` listed under the name of the publisher or developer (NHR 18.8.5) -->
                <text variable="publisher"/>
              </if>
              <else-if type="standard">
                <!-- `standard` listed in bibliography under organization, but note omits this (cf. CMOS18 14.159) -->
                <text variable="authority"/>
              </else-if>
            </choose>
            <choose>
              <if type="manuscript">
                <choose>
                  <if match="none" variable="container-title event-date event-place event-title genre title publisher publisher-place">
                    <text macro="source-archive-short"/>
                  </if>
                </choose>
              </if>
            </choose>
          </substitute>
        </names>
      </else>
    </choose>
  </macro>
  <!-- Author elements -->
  <macro name="author-short-and-recipient">
    <group delimiter=" ">
      <choose>
        <!-- Inaccessible personal commmunication is cited in-text (cf. CMOS18 14.111) -->
        <if match="none" variable="archive archive-place container-title DOI number publisher references URL">
          <!-- These variables indicate whether the letter is retrievable by the reader -->
          <group delimiter=", ">
            <names variable="author">
              <substitute>
                <text macro="title-and-descriptions-short"/>
              </substitute>
            </names>
          </group>
          <choose>
            <if match="none" variable="genre">
              <names variable="recipient">
                <label form="verb-short" suffix=" "/>
                <name/>
              </names>
            </if>
          </choose>
        </if>
        <else-if variable="author recipient">
          <names variable="author">
            <label/>
            <name form="short"/>
          </names>
          <choose>
            <if match="none" variable="genre">
              <names variable="recipient">
                <label form="verb" suffix=" "/>
                <name form="short"/>
              </names>
            </if>
          </choose>
        </else-if>
        <else>
          <names variable="author">
            <name form="short"/>
            <substitute>
              <text macro="title-and-descriptions-short"/>
            </substitute>
          </names>
        </else>
      </choose>
    </group>
  </macro>
  <macro name="author-title-substitute">
    <choose>
      <if match="any" type="review review-book" variable="reviewed-author reviewed-genre reviewed-title">
        <!-- If a review has no `reviewed-genre` or `reviewed-title`, assume that `title` contains the title of the reviewed work; the description provides it. -->
        <choose>
          <if variable="reviewed-genre title">
            <text macro="title"/>
          </if>
          <else-if variable="reviewed-genre reviewed-title title">
            <text macro="title"/>
          </else-if>
          <else>
            <text macro="title-and-descriptions"/>
          </else>
        </choose>
      </if>
      <else-if variable="title">
        <text macro="title"/>
      </else-if>
      <else>
        <!-- If an item has no `title`, substitute with descriptions. -->
        <text macro="title-and-descriptions"/>
      </else>
    </choose>
  </macro>
  <macro name="author-title-substitute-short">
    <choose>
      <if match="any" type="review review-book" variable="reviewed-author reviewed-genre reviewed-title">
        <!-- If a review has no `reviewed-genre` or `reviewed-title`, assume that `title` contains the title of the reviewed work; the description provides it. -->
        <choose>
          <if variable="reviewed-genre title">
            <text macro="title-short"/>
          </if>
          <else-if variable="reviewed-genre reviewed-title title">
            <text macro="title-short"/>
          </else-if>
          <else>
            <text macro="title-and-descriptions-short"/>
          </else>
        </choose>
      </if>
      <else-if variable="title">
        <text macro="title-short"/>
      </else-if>
      <else>
        <!-- If an item has no `title`, substitute with descriptions and capitalize -->
        <text macro="title-and-descriptions"/>
      </else>
    </choose>
  </macro>
  <macro name="author-title-substitute-container">
    <choose>
      <if match="none" variable="container-title"/>
      <else-if match="any" type="article-journal article-magazine article-newspaper periodical post-weblog review review-book">
        <!-- Anonymous serials substitute name of publication (cf. CMOS18 14.87, 14.97, 14.102) -->
        <text macro="source-serial-name"/>
      </else-if>
      <else-if match="any" type="interview paper-conference">
        <choose>
          <if match="none" variable="collection-editor compiler editor editorial-director">
            <!-- serial usage -->
            <text macro="source-serial-name"/>
          </if>
        </choose>
      </else-if>
      <else-if match="any" type="entry entry-dictionary entry-encyclopedia">
        <!-- Anonymous entries in reference works (cf. CMOS18 14.130) -->
        <text font-style="italic" text-case="title" variable="container-title"/>
      </else-if>
      <else-if type="webpage">
        <!-- Website title substituted in bibliography only (cf. CMOS18 14.104) -->
        <text text-case="title" variable="container-title"/>
      </else-if>
    </choose>
  </macro>
  <macro name="author-title-substitute-container-short">
    <choose>
      <if match="none" variable="container-title"/>
      <else-if match="any" type="article-journal article-magazine article-newspaper periodical post-weblog review review-book">
        <!-- Anonymous works in serials substitute name of publication (cf. CMOS18 14.87, 14.97, 14.102) -->
        <text font-style="italic" form="short" text-case="title" variable="container-title"/>
      </else-if>
      <else-if match="any" type="interview paper-conference">
        <choose>
          <if match="none" variable="collection-editor compiler editor editorial-director">
            <!-- serial usage -->
            <text font-style="italic" form="short" text-case="title" variable="container-title"/>
          </if>
        </choose>
      </else-if>
      <else-if match="any" type="entry entry-dictionary entry-encyclopedia">
        <!-- Anonymous entries in reference works (cf. CMOS18 14.130) -->
        <text font-style="italic" form="short" text-case="title" variable="container-title"/>
      </else-if>
      <else-if type="webpage">
        <!-- Website title substituted in bibliography only (cf. CMOS18 14.104) -->
        <text form="short" text-case="title" variable="container-title"/>
      </else-if>
    </choose>
  </macro>
  <macro name="author-title-substitute-reference-note">
    <!-- unsigned reference entries treat `title` as a locator (cf. CMOS18 14.130) -->
    <group delimiter=", ">
      <group delimiter=" ">
        <group delimiter=", ">
          <text macro="author-title-substitute-container"/>
          <text macro="source"/>
        </group>
        <text macro="source-monographic-publication-bracketed"/>
      </group>
      <group delimiter=" ">
        <choose>
          <if locator="sub-verbo"/>
          <else-if variable="container-title title">
            <choose>
              <if match="none" variable="DOI URL">
                <!-- Only print reference entries use `sub-verbo` (cf. CMOS18 14.131) -->
                <text form="short" term="sub-verbo"/>
              </if>
            </choose>
            <text macro="title-primary"/>
          </else-if>
        </choose>
      </group>
    </group>
  </macro>
  <!-- 2. Date -->
  <macro name="date">
    <group prefix="(" suffix=")">
      <choose>
        <if variable="issued">
          <group delimiter=" ">
            <!-- reprints and earlier editions may give original year in brackets (cf. CMOS18 14.16) -->
            <text macro="date-original-year" prefix="[" suffix="]"/>
            <group>
              <text macro="date-issued-year"/>
              <text variable="year-suffix"/>
            </group>
          </group>
        </if>
        <else-if variable="available-date">
          <date date-parts="year" form="text" variable="available-date"/>
        </else-if>
        <else-if variable="event-date">
          <text macro="date-event-year"/>
        </else-if>
        <else-if variable="status">
          <group>
            <!-- Print the status variable rather than use generic CSL terms (`in press`, etc.) -->
            <text text-case="capitalize-first" variable="status"/>
            <text prefix="-" variable="year-suffix"/>
          </group>
        </else-if>
        <else-if type="collection">
          <!-- do not give n.d. for archival collections (cf. CMOS18 14.128) -->
          <text prefix="-" variable="year-suffix"/>
        </else-if>
        <else-if type="manuscript">
          <!-- do not give n.d. with a bare shelfmark -->
          <choose>
            <if match="any" variable="container-title event-date event-place event-title genre title publisher publisher-place">
              <text form="short" term="no date"/>
              <text prefix="-" variable="year-suffix"/>
            </if>
          </choose>
        </else-if>
        <else>
          <text form="short" term="no date"/>
          <text prefix="-" variable="year-suffix"/>
        </else>
      </choose>
    </group>
  </macro>
  <macro name="date-short">
    <choose>
      <if variable="issued">
        <group delimiter=" ">
          <text macro="date-original-year" prefix="[" suffix="]"/>
          <group>
            <choose>
              <if match="any" type="interview personal_communication">
                <choose>
                  <if match="none" variable="archive archive-place container-title DOI number publisher references URL">
                    <!-- These variables indicate that the communication is retrievable by the reader. If not, then use the in-text-only personal communication format -->
                    <text macro="date-issued-full"/>
                  </if>
                  <else>
                    <text macro="date-issued-year"/>
                  </else>
                </choose>
              </if>
              <else>
                <text macro="date-issued-year"/>
              </else>
            </choose>
            <text variable="year-suffix"/>
          </group>
        </group>
      </if>
      <else-if variable="available-date">
        <date date-parts="year" form="text" variable="available-date"/>
      </else-if>
      <else-if variable="event-date">
        <text macro="date-event-year"/>
      </else-if>
      <else-if variable="status">
        <!-- Print the status variable rather than use generic CSL terms (`in press`, etc.) -->
        <text text-case="lowercase" variable="status"/>
        <text prefix="-" variable="year-suffix"/>
      </else-if>
      <else-if match="any" type="interview personal_communication">
        <choose>
          <if match="any" variable="archive archive-place container-title DOI number publisher references URL">
            <!-- only give n.d. for accessible personal communication (cf. CMOS18 14.111)-->
            <text form="short" term="no date"/>
          </if>
        </choose>
        <text prefix="-" variable="year-suffix"/>
      </else-if>
      <else-if match="any" type="classic collection entry entry-dictionary entry-encyclopedia manuscript">
        <!-- do not give n.d. for archival collections (cf. CMOS18 14.128), `classic` (cf. 14.143), manuscripts (NHR 18.6.2), or reference entries (cf. 14.131) -->
        <text prefix="-" variable="year-suffix"/>
      </else-if>
      <else>
        <text form="short" term="no date"/>
        <text prefix="-" variable="year-suffix"/>
      </else>
    </choose>
  </macro>
  <macro name="date-sort-group">
    <!-- Sort items with and without dates (cf. CMOS18 14.44):

          1. items with dates (= 0)
          2. `no date` items (= 1)
          3. items with `status` (forthcoming, in press, etc.) (= 2) -->
    <choose>
      <if variable="issued">
        <text value="0"/>
      </if>
      <else-if variable="status">
        <text value="2"/>
      </else-if>
      <else>
        <!-- n.d. -->
        <text value="1"/>
      </else>
    </choose>
  </macro>
  <macro name="date-sort-year">
    <choose>
      <if type="personal_communication" variable="event-date issued">
        <date date-parts="year" form="text" variable="event-date"/>
      </if>
      <else>
        <date date-parts="year" form="text" variable="issued"/>
      </else>
    </choose>
  </macro>
  <!-- Date elements -->
  <macro name="date-event-full">
    <choose>
      <if is-uncertain-date="issued">
        <group prefix="[" suffix="]">
          <text font-style="italic" form="short" term="circa"/>
          <date form="text" variable="event-date"/>
        </group>
      </if>
      <else>
        <date form="text" variable="event-date"/>
      </else>
    </choose>
  </macro>
  <macro name="date-event-year">
    <choose>
      <if is-uncertain-date="issued">
        <group prefix="[" suffix="]">
          <text font-style="italic" form="short" term="circa"/>
          <date date-parts="year" form="text" variable="event-date"/>
        </group>
      </if>
      <else>
        <date date-parts="year" form="text" variable="event-date"/>
      </else>
    </choose>
  </macro>
  <macro name="date-issued-full">
    <choose>
      <if is-uncertain-date="issued">
        <group prefix="[" suffix="]">
          <text font-style="italic" form="short" term="circa"/>
          <date form="text" variable="issued"/>
        </group>
      </if>
      <else>
        <date form="text" variable="issued"/>
      </else>
    </choose>
  </macro>
  <macro name="date-issued-month">
    <date variable="issued">
      <date-part name="month"/>
    </date>
  </macro>
  <macro name="date-issued-day-month">
    <date variable="issued">
      <date-part name="day"/>
      <date-part name="month" prefix=" "/>
    </date>
  </macro>
  <macro name="date-issued-year">
    <choose>
      <if is-uncertain-date="issued">
        <group prefix="[" suffix="]">
          <text font-style="italic" form="short" term="circa"/>
          <date date-parts="year" form="text" variable="issued"/>
        </group>
      </if>
      <else>
        <date date-parts="year" form="text" variable="issued"/>
      </else>
    </choose>
  </macro>
  <macro name="date-issued-year-month">
    <choose>
      <if is-uncertain-date="issued">
        <group prefix="[" suffix="]">
          <text font-style="italic" form="short" term="circa"/>
          <date date-parts="year-month" form="text" variable="issued"/>
        </group>
      </if>
      <else>
        <date date-parts="year-month" form="text" variable="issued"/>
      </else>
    </choose>
  </macro>
  <macro name="date-original-full">
    <choose>
      <if is-uncertain-date="original-date">
        <group prefix="[" suffix="]">
          <text font-style="italic" form="short" term="circa"/>
          <date form="text" variable="original-date"/>
        </group>
      </if>
      <else>
        <date form="text" variable="original-date"/>
      </else>
    </choose>
  </macro>
  <macro name="date-original-month">
    <date variable="original-date">
      <date-part name="month"/>
    </date>
  </macro>
  <macro name="date-original-day-month">
    <date variable="original-date">
      <date-part name="day"/>
      <date-part name="month" prefix=" "/>
    </date>
  </macro>
  <macro name="date-original-year">
    <choose>
      <if is-uncertain-date="original-date">
        <group prefix="[" suffix="]">
          <text font-style="italic" form="short" term="circa"/>
          <date date-parts="year" form="text" variable="original-date"/>
        </group>
      </if>
      <else>
        <date date-parts="year" form="text" variable="original-date"/>
      </else>
    </choose>
  </macro>
  <macro name="date-original-year-month">
    <choose>
      <if is-uncertain-date="original-date">
        <group prefix="[" suffix="]">
          <text font-style="italic" form="short" term="circa"/>
          <date date-parts="year-month" form="text" variable="original-date"/>
        </group>
      </if>
      <else>
        <date date-parts="year-month" form="text" variable="original-date"/>
      </else>
    </choose>
  </macro>
  <!-- 3. Title and descriptions (cf. CMOS18 13.87–101) -->
  <macro name="title-and-descriptions">
    <group delimiter=", ">
      <choose>
        <if variable="title">
          <text macro="title"/>
          <text macro="description"/>
          <text macro="identifier"/>
        </if>
        <else>
          <text macro="description"/>
          <text macro="identifier"/>
        </else>
      </choose>
    </group>
  </macro>
  <macro name="title-and-descriptions-short">
    <choose>
      <if variable="title">
        <group delimiter=", ">
          <text macro="title-short"/>
          <choose>
            <if match="none" type="entry entry-dictionary entry-encyclopedia"/>
            <else-if match="none" variable="author">
              <!-- give container title to distinguish an unsigned reference entry -->
              <text font-style="italic" variable="container-title"/>
            </else-if>
          </choose>
        </group>
      </if>
      <else>
        <text macro="description-short"/>
      </else>
    </choose>
  </macro>
  <macro name="title-and-source">
    <group delimiter=", ">
      <group delimiter=" ">
        <group delimiter=", ">
          <group delimiter=" ">
            <group delimiter=", ">
              <choose>
                <if type="chapter" variable="container-title genre">
                  <!-- 'introduction in' (NHR 18.2.6; cf. CMOS18 14.12, 14.14) -->
                  <group delimiter=" ">
                    <text macro="title-and-descriptions"/>
                    <text macro="source"/>
                  </group>
                </if>
                <else>
                  <text macro="title-and-descriptions"/>
                  <text macro="source"/>
                </else>
              </choose>
              <text macro="source-monographic-publication-unbracketed"/>
            </group>
            <text macro="source-monographic-publication-bracketed"/>
          </group>
          <choose>
            <!-- Locator for monographic types only; serial locator handled in `source-serial-locator` -->
            <if match="any" type="article-journal article-magazine article-newspaper periodical post-weblog review review-book"/>
            <else-if match="any" type="interview paper-conference">
              <choose>
                <if match="any" variable="collection-editor container-author editor editorial-director">
                  <!-- monographic usage -->
                  <text macro="source-monographic-locator"/>
                  <!-- for OGS: -->
                  <!-- <text macro="source-monographic-locator-range"/> -->
                </if>
              </choose>
            </else-if>
            <else>
              <text macro="source-monographic-locator"/>
              <!-- for OGS: -->
              <!-- <text macro="source-monographic-locator-range"/> -->
            </else>
          </choose>
        </group>
        <text macro="source-medium" prefix="[" suffix="]"/>
      </group>
      <text macro="source-archive"/>
      <text macro="source-DOI-URL"/>
    </group>
  </macro>
  <!-- 3.1. Title -->
  <macro name="title">
    <choose>
      <if match="any" type="post webpage">
        <!-- Handle `container-title` on `post` or `webpage` in manner of `publisher` -->
        <text macro="title-and-part-filter-review"/>
      </if>
      <else-if match="any" type="article-journal article-magazine article-newspaper periodical post-weblog review review-book">
        <text macro="title-and-part-filter-review"/>
      </else-if>
      <else-if match="any" type="interview paper-conference">
        <choose>
          <if match="any" variable="collection-editor compiler editor editorial-director">
            <!-- monographic usage -->
            <text macro="title-monographic"/>
          </if>
          <else>
            <!-- serial usage -->
            <text macro="title-and-part-filter-review"/>
          </else>
        </choose>
      </else-if>
      <else>
        <text macro="title-monographic"/>
      </else>
    </choose>
  </macro>
  <macro name="title-short">
    <choose>
      <if match="any" type="review review-book" variable="reviewed-author reviewed-genre reviewed-title">
        <!-- If a review has no `reviewed-title`, assume that `title` contains the title of the reviewed work; the description provides it. -->
        <choose>
          <if variable="reviewed-genre title">
            <!-- Quotes, title case -->
            <text form="short" quotes="true" text-case="title" variable="title"/>
          </if>
          <else-if variable="reviewed-genre reviewed-title title">
            <!-- Quotes, title case -->
            <text form="short" quotes="true" text-case="title" variable="title"/>
          </else-if>
          <else>
            <text macro="description-short"/>
          </else>
        </choose>
      </if>
      <else>
        <text macro="title-primary-short"/>
      </else>
    </choose>
  </macro>
  <!-- Title elements -->
  <macro name="title-and-part-filter-review">
    <choose>
      <if match="any" type="review review-book" variable="reviewed-author reviewed-genre reviewed-title">
        <!-- `title` is only the review title if there is a separate `reviewed-genre` or `reviewed-title`; otherwise, it is the title of the reviewed work, printed in the description -->
        <choose>
          <if match="any" variable="reviewed-genre reviewed-title">
            <text macro="title-and-part-title"/>
          </if>
        </choose>
      </if>
      <else>
        <text macro="title-and-part-title"/>
      </else>
    </choose>
  </macro>
  <macro name="title-and-part-title">
    <group delimiter=", ">
      <text macro="title-primary"/>
      <group delimiter=": ">
        <text macro="label-part-number"/>
        <text macro="title-part"/>
      </group>
    </group>
  </macro>
  <macro name="title-monographic">
    <!-- For monographic items, assume `part-number` and `part-title` refer to the book/volume. -->
    <choose>
      <if variable="container-title">
        <text macro="title-primary"/>
      </if>
      <else>
        <!-- For monographic items without `container-title` and with `volume-title`, append `volume-title` to `title` (APA example 30) -->
        <group delimiter=", ">
          <text macro="title-primary"/>
          <text macro="title-volume"/>
        </group>
      </else>
    </choose>
  </macro>
  <macro name="title-part">
    <choose>
      <if type="patent">
        <!-- No italics or quotes, sentence case -->
        <text form="short" text-case="capitalize-first" variable="part-title"/>
      </if>
      <else-if match="any" type="bill collection legislation regulation treaty">
        <!-- No italics or quotes, title case -->
        <text text-case="title" variable="part-title"/>
      </else-if>
      <else-if match="any" type="book classic graphic hearing map periodical">
        <!-- Italicized, title case (regardless of `container-title`) -->
        <text font-style="italic" text-case="title" variable="part-title"/>
      </else-if>
      <else-if type="entry-encyclopedia" variable="author container-title">
        <!-- Signed encyclopedia entry in quotes, title case (cf. CMOS18 14.132) -->
        <text quotes="true" text-case="title" variable="part-title"/>
      </else-if>
      <else-if type="entry-dictionary" variable="container-title">
        <!-- Quotes, sentence case -->
        <text quotes="true" variable="part-title"/>
      </else-if>
      <else-if type="entry-encyclopedia" variable="container-title">
        <!-- Quotes, sentence case -->
        <text quotes="true" variable="part-title"/>
      </else-if>
      <else-if type="post">
        <!-- Quotes, sentence case -->
        <text quotes="true" variable="part-title"/>
      </else-if>
      <!-- Other types are formatted based on presence of `container-title` -->
      <else-if variable="container-title">
        <!-- Quotes, title case -->
        <text quotes="true" text-case="title" variable="part-title"/>
      </else-if>
      <else-if match="any" type="article dataset document interview manuscript paper-conference personal_communication speech thesis webpage">
        <!-- Container-like but not necessarily with `container-title` -->
        <!-- Quotes, title case -->
        <text quotes="true" text-case="title" variable="part-title"/>
      </else-if>
      <else>
        <!-- Italicized, title case (default) -->
        <text font-style="italic" text-case="title" variable="part-title"/>
      </else>
    </choose>
  </macro>
  <macro name="title-primary">
    <choose>
      <if type="patent">
        <!-- No italics or quotes, sentence case -->
        <text form="short" text-case="capitalize-first" variable="title"/>
      </if>
      <else-if match="any" type="bill collection legislation regulation treaty">
        <!-- No italics or quotes, title case -->
        <text text-case="title" variable="title"/>
      </else-if>
      <else-if match="any" type="book classic graphic hearing map periodical">
        <!-- Italicized, title case (regardless of `container-title`) -->
        <text font-style="italic" text-case="title" variable="title"/>
      </else-if>
      <else-if type="entry-encyclopedia" variable="author container-title">
        <!-- Signed encyclopedia entry in quotes, title case (cf. CMOS18 14.132) -->
        <text quotes="true" text-case="title" variable="title"/>
      </else-if>
      <else-if type="entry-dictionary" variable="container-title">
        <!-- Quotes, sentence case -->
        <text quotes="true" variable="title"/>
      </else-if>
      <else-if type="entry-encyclopedia" variable="container-title">
        <!-- Quotes, sentence case -->
        <text quotes="true" variable="title"/>
      </else-if>
      <else-if type="post">
        <!-- Quotes, sentence case -->
        <text quotes="true" variable="title"/>
      </else-if>
      <!-- Other types are formatted based on presence of `container-title` -->
      <else-if variable="container-title">
        <!-- Quotes, title case -->
        <text quotes="true" text-case="title" variable="title"/>
      </else-if>
      <else-if match="any" type="article dataset document interview manuscript paper-conference personal_communication speech thesis webpage">
        <!-- Container-like but not necessarily with `container-title` -->
        <!-- Quotes, title case -->
        <text quotes="true" text-case="title" variable="title"/>
      </else-if>
      <else>
        <!-- Italicized, title case (default) -->
        <text font-style="italic" text-case="title" variable="title"/>
      </else>
    </choose>
  </macro>
  <macro name="title-primary-short">
    <choose>
      <if type="patent">
        <!-- No italics or quotes, sentence case -->
        <text form="short" text-case="capitalize-first" variable="title"/>
      </if>
      <else-if match="any" type="bill collection legislation regulation treaty">
        <!-- No italics or quotes, title case -->
        <text form="short" text-case="title" variable="title"/>
      </else-if>
      <else-if match="any" type="book classic graphic hearing map periodical">
        <!-- Italicized, title case (regardless of `container-title`) -->
        <text font-style="italic" form="short" text-case="title" variable="title"/>
      </else-if>
      <else-if type="entry-encyclopedia" variable="author container-title">
        <!-- Signed encyclopedia entry in quotes, title case (cf. CMOS18 14.132) -->
        <text form="short" quotes="true" text-case="title" variable="title"/>
      </else-if>
      <else-if type="entry-dictionary" variable="container-title">
        <!-- Quotes, sentence case -->
        <text form="short" quotes="true" variable="title"/>
      </else-if>
      <else-if type="entry-encyclopedia" variable="container-title">
        <!-- Quotes, sentence case -->
        <text form="short" quotes="true" variable="title"/>
      </else-if>
      <else-if type="post">
        <!-- Quotes, sentence case -->
        <text form="short" quotes="true" variable="title"/>
      </else-if>
      <!-- Other types are formatted based on presence of `container-title` -->
      <else-if variable="container-title">
        <!-- Quotes, title case -->
        <text form="short" quotes="true" text-case="title" variable="title"/>
      </else-if>
      <else-if match="any" type="article dataset document interview manuscript paper-conference personal_communication speech thesis webpage">
        <!-- Container-like but not necessarily with `container-title` -->
        <!-- Quotes, title case -->
        <text form="short" quotes="true" text-case="title" variable="title"/>
      </else-if>
      <else>
        <!-- Italicized, title case (default) -->
        <text font-style="italic" form="short" text-case="title" variable="title"/>
      </else>
    </choose>
  </macro>
  <macro name="title-volume">
    <group delimiter=", ">
      <group delimiter=": ">
        <choose>
          <!-- negotiate with `source-monographic-locator` -->
          <if match="any" variable="part-title volume-title">
            <text macro="label-volume"/>
          </if>
          <else-if match="none" variable="locator page">
            <text macro="label-volume"/>
          </else-if>
        </choose>
        <text font-style="italic" text-case="title" variable="volume-title"/>
      </group>
      <!-- `part-number` and `part-title` of monographic items refer to the source book/volume -->
      <group delimiter=": ">
        <choose>
          <if match="any" variable="part-title volume-title">
            <text macro="label-part-number"/>
          </if>
          <else-if match="none" variable="locator page">
            <text macro="label-part-number"/>
          </else-if>
        </choose>
        <text macro="title-part"/>
      </group>
    </group>
  </macro>
  <!-- 3.2. Description -->
  <macro name="description">
    <choose>
      <if match="any" type="interview" variable="interviewer">
        <text macro="description-interview"/>
      </if>
      <else-if match="any" type="review review-book" variable="reviewed-author reviewed-genre reviewed-title">
        <text macro="description-review"/>
      </else-if>
      <else-if type="personal_communication">
        <text macro="description-letter"/>
      </else-if>
      <else-if match="any" type="article-journal article-magazine article-newspaper periodical post-weblog review review-book">
        <text macro="description-serial"/>
      </else-if>
      <else-if type="paper-conference">
        <text macro="description-paper-conference"/>
      </else-if>
      <else-if type="song" variable="composer">
        <text macro="description-song"/>
      </else-if>
      <!-- thesis type appears with university name (cf. CMOS18 14.113) -->
      <else-if type="thesis"/>
      <else-if match="none" variable="container-title">
        <!-- Other description -->
        <text macro="description-format"/>
      </else-if>
      <else>
        <text macro="description-generic"/>
      </else>
    </choose>
  </macro>
  <macro name="description-short">
    <choose>
      <if match="any" type="interview" variable="interviewer">
        <text macro="description-interview-short"/>
      </if>
      <else-if match="any" type="review review-book" variable="reviewed-author reviewed-genre reviewed-title">
        <text macro="description-review-short"/>
      </else-if>
      <else-if type="personal_communication">
        <text macro="description-letter-short"/>
      </else-if>
      <else-if match="any" type="article-journal article-magazine article-newspaper periodical post-weblog review review-book">
        <text macro="description-serial-short"/>
      </else-if>
      <else-if type="paper-conference">
        <choose>
          <if match="any" variable="collection-editor container-author editor editorial-director">
            <!-- monographic usage -->
            <text macro="description-format-short"/>
          </if>
          <else>
            <!-- serial usage -->
            <text macro="description-serial-short"/>
          </else>
        </choose>
      </else-if>
      <else>
        <text macro="description-format-short"/>
      </else>
    </choose>
  </macro>
  <!-- Description elements -->
  <macro name="description-format">
    <choose>
      <if variable="genre number"/>
      <else-if variable="genre">
        <text variable="genre"/>
      </else-if>
      <else-if type="manuscript">
        <!-- 'unpublished manuscript' if no `genre` (cf. CMOS18 14.114) -->
        <choose>
          <if match="none" variable="archive archive-place container-title DOI number publisher references URL">
            <text term="manuscript"/>
          </if>
        </choose>
      </else-if>
      <else-if type="personal_communication">
        <!-- 'personal communication' if no `genre` (cf. CMOS18 14.111) -->
        <choose>
          <if match="none" variable="archive archive-place container-title DOI number publisher references URL">
            <text term="personal-communication" text-case="capitalize-first"/>
          </if>
        </choose>
      </else-if>
      <else-if variable="chapter-number title"/>
      <else-if variable="chapter-number">
        <text macro="label-chapter-number-long"/>
      </else-if>
    </choose>
  </macro>
  <macro name="description-format-short">
    <choose>
      <if variable="genre">
        <text variable="genre"/>
      </if>
      <else-if variable="medium">
        <text variable="medium"/>
      </else-if>
      <else-if variable="chapter-number">
        <text macro="label-chapter-number"/>
      </else-if>
      <else-if type="manuscript">
        <!-- 'unpublished manuscript' if no `genre` (cf. CMOS18 14.114) -->
        <choose>
          <if match="none" variable="archive archive-place container-title DOI number publisher references URL">
            <text term="manuscript"/>
          </if>
        </choose>
      </else-if>
      <else-if type="personal_communication">
        <!-- 'pers. comm.' if no `genre` (cf. CMOS18 14.111) -->
        <choose>
          <if match="none" variable="archive archive-place container-title DOI number publisher references URL">
            <text form="short" term="personal-communication"/>
          </if>
        </choose>
      </else-if>
    </choose>
  </macro>
  <macro name="description-generic">
    <!-- For conference presentations/performances/events, chapters in reports/standards/generic documents, software, place description within the source element -->
    <choose>
      <if match="any" type="event paper-conference performance speech">
        <choose>
          <if match="any" variable="collection-editor compiler editor editorial-director">
            <!-- monographic usage -->
            <text macro="description-format"/>
          </if>
        </choose>
      </if>
      <else-if match="none" type="document report software standard">
        <text macro="description-format"/>
      </else-if>
    </choose>
  </macro>
  <macro name="description-interview">
    <group delimiter=", ">
      <choose>
        <if variable="genre number">
          <!-- `genre` printed with `number` -->
          <names variable="interviewer">
            <label form="verb" suffix=" "/>
            <name/>
          </names>
        </if>
        <else-if variable="genre">
          <group delimiter=" ">
            <text variable="genre"/>
            <group delimiter=" ">
              <text form="verb" term="container-author"/>
              <names variable="interviewer"/>
            </group>
          </group>
        </else-if>
        <else-if variable="interviewer">
          <names variable="interviewer">
            <label form="verb" suffix=" "/>
            <name/>
          </names>
        </else-if>
        <else>
          <text macro="description-format"/>
        </else>
      </choose>
      <text macro="source-event-place-first"/>
    </group>
  </macro>
  <macro name="description-interview-short">
    <choose>
      <if disambiguate="true">
        <names variable="interviewer">
          <label form="verb" suffix=" "/>
          <name/>
          <substitute>
            <text macro="description-format-short"/>
          </substitute>
        </names>
      </if>
      <else-if match="any" variable="genre medium">
        <choose>
          <if match="none" variable="author chair collection-editor compiler composer curator director editor editor-translator editorial-director executive-producer guest host illustrator organizer producer series-creator translator">
            <!-- capitalize if no author or title -->
            <text macro="description-format"/>
          </if>
          <else>
            <text macro="description-format-short"/>
          </else>
        </choose>
      </else-if>
      <else>
        <!-- generic description for an unpublished interview (cf. CMOS18 14.108) -->
        <text term="interview"/>
      </else>
    </choose>
  </macro>
  <macro name="description-letter">
    <choose>
      <if variable="recipient">
        <group delimiter=", ">
          <choose>
            <if variable="genre number">
              <!-- `genre` appears with `number` -->
              <names variable="recipient">
                <label form="verb" suffix=" "/>
                <name/>
              </names>
            </if>
            <else>
              <group delimiter=" ">
                <text macro="description-format"/>
                <names variable="recipient">
                  <label form="verb" suffix=" "/>
                  <name/>
                </names>
              </group>
            </else>
          </choose>
          <text variable="event-place"/>
          <text macro="date-event-full"/>
        </group>
      </if>
      <else>
        <text macro="description-format"/>
      </else>
    </choose>
  </macro>
  <macro name="description-letter-short">
    <!-- shortened notes ideally give author, recipient, place, and date (cf. CMOS18 14.13) -->
    <group delimiter=", ">
      <choose>
        <if variable="genre recipient">
          <group delimiter=" ">
            <text macro="description-format-short"/>
            <names variable="recipient">
              <label form="verb" suffix=" "/>
              <name/>
            </names>
          </group>
        </if>
        <else>
          <text macro="description-format-short"/>
        </else>
      </choose>
      <text variable="event-place"/>
      <text macro="date-event-full"/>
    </group>
  </macro>
  <macro name="description-paper-conference">
    <choose>
      <if match="any" variable="collection-editor container-author editor editorial-director">
        <!-- monographic usage -->
        <text macro="description-generic"/>
      </if>
      <else>
        <!-- serial usage -->
        <group delimiter=", ">
          <text macro="description-serial"/>
          <text macro="source-event"/>
        </group>
      </else>
    </choose>
  </macro>
  <macro name="description-review">
    <group delimiter=", ">
      <group delimiter=" ">
        <choose>
          <if variable="genre">
            <!-- assume that `genre` is entered as 'Review of the book' or similar -->
            <text variable="genre"/>
          </if>
          <else>
            <text term="review-of"/>
          </else>
        </choose>
        <group delimiter=", ">
          <names variable="reviewed-author"/>
          <choose>
            <if match="any" variable="reviewed-genre reviewed-title">
              <!-- Not possible to distinguish TV series episode from other reviewed works without a reviewed source title -->
              <!-- Adapt for `reviewed-container-title` or similar if it becomes available -->
              <text font-style="italic" text-case="title" variable="reviewed-title"/>
            </if>
            <else>
              <!-- Assume title is title of reviewed work -->
              <text font-style="italic" text-case="title" variable="title"/>
            </else>
          </choose>
          <text variable="reviewed-genre"/>
        </group>
        <text macro="source-event-place-first" prefix="(" suffix=")"/>
      </group>
      <text macro="label-section"/>
    </group>
  </macro>
  <macro name="description-review-short">
    <group delimiter=" ">
      <text term="review-of"/>
      <choose>
        <if match="any" variable="reviewed-genre reviewed-title">
          <!-- Not possible to distinguish TV series episode from other reviewed works without a reviewed source title -->
          <!-- Adapt for `reviewed-container-title` or similar if it becomes available -->
          <text font-style="italic" form="short" text-case="title" variable="reviewed-title"/>
        </if>
        <else>
          <!-- Assume title is title of reviewed work -->
          <text font-style="italic" form="short" text-case="title" variable="title"/>
        </else>
      </choose>
    </group>
  </macro>
  <macro name="description-serial">
    <group delimiter=", ">
      <text macro="description-format"/>
      <!-- `section` provides magazine departments (cf. CMOS18 14.88) and newspaper column names (cf. CMOS18 14.93) -->
      <text macro="label-section"/>
    </group>
  </macro>
  <macro name="description-serial-short">
    <choose>
      <if variable="title"/>
      <else-if variable="genre">
        <text macro="description-format-short"/>
      </else-if>
      <else>
        <text variable="section"/>
      </else>
    </choose>
  </macro>
  <macro name="description-song">
    <!-- Performer of classical music works -->
    <!-- TODO: remove when Zotero fixes mapping of performer to `author` -->
    <group delimiter=" ">
      <!-- Based on `description-format` macro -->
      <choose>
        <if variable="genre">
          <text variable="genre"/>
          <text form="verb" term="performer"/>
        </if>
      </choose>
      <names variable="author">
        <name delimiter-precedes-last="always"/>
        <substitute>
          <names variable="performer"/>
        </substitute>
      </names>
    </group>
  </macro>
  <!-- 3.3. Identifier (contributors) -->
  <macro name="identifier">
    <group delimiter=", ">
      <choose>
        <if type="patent">
          <text macro="identifier-patent"/>
        </if>
        <else-if type="report">
          <text macro="identifier-report"/>
        </else-if>
        <else-if match="any" type="post webpage">
          <!-- Handle `container-title` on `post` or `webpage` as `publisher` -->
          <text macro="identifier-number"/>
          <text macro="label-version"/>
          <text macro="identifier-edition"/>
          <text macro="identifier-contributors"/>
          <text macro="identifier-volume"/>
        </else-if>
        <else-if variable="container-title">
          <choose>
            <if match="any" type="broadcast graphic map motion_picture">
              <!-- For audiovisual media, number information comes after `title`, not `container-title`; `song` places album catalogue `number` with `publisher` (cf. CMOS18 14.163-164) -->
              <text macro="identifier-number"/>
            </if>
          </choose>
          <text macro="identifier-contributors"/>
        </else-if>
        <else>
          <choose>
            <if match="none" type="song">
              <text macro="identifier-number"/>
            </if>
          </choose>
          <text macro="label-version"/>
          <text macro="identifier-edition"/>
          <text macro="identifier-contributors"/>
          <text macro="identifier-volume"/>
        </else>
      </choose>
    </group>
  </macro>
  <!-- Identifier elements -->
  <macro name="identifier-contributors">
    <choose>
      <if match="any" type="article-journal article-magazine article-newspaper periodical post-weblog review review-book">
        <text macro="identifier-contributors-serial"/>
      </if>
      <else-if match="any" type="interview paper-conference">
        <choose>
          <if match="any" variable="collection-editor compiler editor editorial-director">
            <!-- monographic usage -->
            <text macro="identifier-contributors-monographic"/>
          </if>
          <else>
            <!-- serial usage -->
            <text macro="identifier-contributors-serial"/>
          </else>
        </choose>
      </else-if>
      <else>
        <text macro="identifier-contributors-monographic"/>
      </else>
    </choose>
  </macro>
  <macro name="identifier-contributors-monographic">
    <group delimiter=", ">
      <choose>
        <if match="any" type="post webpage">
          <group delimiter=", ">
            <names variable="container-author">
              <label form="verb-short" suffix=" "/>
              <name/>
            </names>
            <names variable="editor-translator">
              <label form="verb-short" suffix=" "/>
              <name/>
            </names>
            <names delimiter=", " variable="editor translator">
              <label form="verb-short" suffix=" "/>
              <name/>
            </names>
            <names variable="editorial-director">
              <label form="verb-short" suffix=" "/>
              <name/>
            </names>
            <names variable="guest">
              <label form="verb" suffix=" "/>
              <name/>
            </names>
            <names variable="host">
              <label form="verb-short" suffix=" "/>
              <name/>
            </names>
            <names delimiter=", " variable="illustrator narrator">
              <label form="verb-short" suffix=" "/>
              <name/>
            </names>
            <names delimiter=", " variable="compiler chair organizer curator">
              <label form="verb-short" suffix=" "/>
              <name/>
            </names>
            <names delimiter=", " variable="series-creator executive-producer">
              <label form="verb" suffix=" "/>
              <name/>
            </names>
            <names variable="producer">
              <label form="verb-short" suffix=" "/>
              <name/>
            </names>
            <names variable="director">
              <label form="verb-short" suffix=" "/>
              <name/>
            </names>
            <names variable="performer">
              <label form="verb-short" suffix=" "/>
              <name/>
            </names>
            <choose>
              <if type="thesis"/>
              <else>
                <names variable="contributor">
                  <label form="verb-short" suffix=" "/>
                  <name/>
                </names>
              </else>
            </choose>
          </group>
        </if>
        <else>
          <!-- Handle `container-title` on `post` or `webpage` as `publisher` -->
          <group delimiter=", ">
            <choose>
              <if match="none" variable="container-title">
                <names variable="container-author">
                  <label form="verb-short" suffix=" "/>
                  <name/>
                </names>
                <names variable="editor-translator">
                  <label form="verb-short" suffix=" "/>
                  <name/>
                </names>
                <names delimiter=", " variable="editor translator">
                  <label form="verb-short" suffix=" "/>
                  <name/>
                </names>
                <names variable="editorial-director">
                  <label form="verb-short" suffix=" "/>
                  <name/>
                </names>
                <names variable="guest">
                  <label form="verb" suffix=" "/>
                  <name/>
                </names>
                <names variable="host">
                  <label form="verb-short" suffix=" "/>
                  <name/>
                </names>
              </if>
            </choose>
            <names delimiter=", " variable="illustrator">
              <label form="verb-short" suffix=" "/>
              <name/>
            </names>
            <names delimiter=", " variable="narrator">
              <label form="verb-short" suffix=" "/>
              <name/>
            </names>
            <choose>
              <if match="none" variable="container-title">
                <names delimiter=", " variable="compiler chair organizer curator">
                  <label form="verb-short" suffix=" "/>
                  <name/>
                </names>
                <names delimiter=", " variable="series-creator executive-producer">
                  <label form="verb" suffix=" "/>
                  <name/>
                </names>
                <names variable="producer">
                  <label form="verb-short" suffix=" "/>
                  <name/>
                </names>
                <names variable="director">
                  <label form="verb-short" suffix=" "/>
                  <name/>
                </names>
                <names variable="performer">
                  <label form="verb-short" suffix=" "/>
                  <name/>
                </names>
                <choose>
                  <if type="song"/>
                  <else-if type="thesis"/>
                  <else>
                    <names variable="contributor">
                      <label form="verb-short" suffix=" "/>
                      <name/>
                    </names>
                  </else>
                </choose>
              </if>
            </choose>
            <choose>
              <if type="song">
                <!-- Song contributors attached to album (cf. CMOS18 14.163) -->
                <names variable="contributor">
                  <label form="verb-short" suffix=" "/>
                  <name/>
                </names>
              </if>
            </choose>
          </group>
        </else>
      </choose>
    </group>
  </macro>
  <macro name="identifier-contributors-serial">
    <group delimiter=", ">
      <choose>
        <if type="periodical">
          <names variable="editor">
            <label form="verb-short" suffix=" "/>
            <name/>
          </names>
        </if>
      </choose>
      <names delimiter=", " variable="translator narrator">
        <label form="verb-short" suffix=" "/>
        <name/>
      </names>
      <names delimiter=", " variable="compiler chair organizer curator">
        <label form="verb-short" suffix=" "/>
        <name/>
      </names>
      <names delimiter=", " variable="series-creator executive-producer">
        <label form="verb" suffix=" "/>
        <name/>
      </names>
      <names variable="producer">
        <!-- not abbreviated (cf. CMOS18 14.168) -->
        <label form="verb" suffix=" "/>
        <name/>
      </names>
      <names variable="director">
        <label form="verb-short" suffix=" "/>
        <name/>
      </names>
      <names variable="performer">
        <label form="verb-short" suffix=" "/>
        <name/>
      </names>
    </group>
  </macro>
  <macro name="identifier-edition">
    <choose>
      <if variable="original-title">
        <text macro="label-edition"/>
      </if>
      <else-if variable="original-date"/>
      <else-if variable="editor">
        <!-- different positioning of edition depending on whether there is a reviser; CSL does not have a proper role for this (NHR 18.2.1) -->
        <text macro="label-edition"/>
      </else-if>
    </choose>
  </macro>
  <macro name="identifier-number">
    <group delimiter=" ">
      <choose>
        <if is-numeric="number" type="broadcast" variable="genre">
          <text variable="genre"/>
          <text variable="number"/>
        </if>
        <else-if is-numeric="number" type="broadcast">
          <text value="episode"/>
          <text variable="number"/>
        </else-if>
        <else-if variable="number">
          <text variable="genre"/>
          <text macro="label-number"/>
        </else-if>
      </choose>
    </group>
  </macro>
  <macro name="identifier-patent">
    <group delimiter=", ">
      <group delimiter=" ">
        <!-- `authority`: US ; `genre`: patent ; `number`: 123,445 -->
        <text form="short" variable="authority"/>
        <!-- 'US Patent' capitalized in both bibliography and note forms -->
        <choose>
          <if variable="genre">
            <text text-case="capitalize-first" variable="genre"/>
          </if>
          <else>
            <text term="patent" text-case="capitalize-first"/>
          </else>
        </choose>
        <text variable="number"/>
      </group>
      <group delimiter=" ">
        <text value="filed"/>
        <date form="text" variable="submitted"/>
      </group>
      <group delimiter=" ">
        <choose>
          <if variable="issued submitted">
            <text term="and"/>
          </if>
        </choose>
        <text value="issued"/>
        <!-- Always give full issue date, even in author-date (cf. CMOS18 14.158) -->
        <text macro="date-issued-full"/>
      </group>
    </group>
  </macro>
  <macro name="identifier-report">
    <group delimiter=", ">
      <choose>
        <if variable="container-title">
          <!-- If the report is a chapter in a larger report, then most identifying information is printed in the source. -->
          <text macro="identifier-contributors"/>
        </if>
        <else-if variable="title">
          <text macro="identifier-number"/>
          <text macro="identifier-contributors"/>
        </else-if>
        <else>
          <!-- If there is no `title`, then `genre` and `number` are already printed as the title. -->
          <text macro="identifier-contributors"/>
        </else>
      </choose>
    </group>
  </macro>
  <macro name="identifier-volume">
    <choose>
      <if match="none" variable="part-number part-title volume volume-title">
        <text macro="label-number-of-volumes"/>
      </if>
    </choose>
  </macro>
  <!-- 4. Source -->
  <macro name="source">
    <group delimiter=", ">
      <choose>
        <if match="any" type="article-journal article-magazine article-newspaper periodical post-weblog review review-book">
          <!-- Serial items -->
          <text macro="source-serial"/>
        </if>
        <else-if match="any" type="interview paper-conference">
          <choose>
            <if match="any" variable="collection-editor container-author editor editorial-director">
              <!-- monographic usage -->
              <text macro="source-monographic"/>
            </if>
            <else>
              <!-- serial usage -->
              <text macro="source-serial"/>
            </else>
          </choose>
        </else-if>
        <else-if match="any" type="patent post webpage"/>
        <else>
          <text macro="source-monographic"/>
        </else>
      </choose>
    </group>
  </macro>
  <!-- 4.1. Serial sources -->
  <macro name="source-serial">
    <group delimiter=", ">
      <text macro="source-serial-title-volume"/>
      <choose>
        <!-- use correct punctuation depending on whether a bracket immediately follows the title -->
        <if type="article-newspaper">
          <group delimiter=" ">
            <text macro="source-serial-title"/>
            <text macro="source-serial-identifier"/>
          </group>
        </if>
        <else-if match="any" variable="collection-title issue supplement-number volume">
          <text macro="source-serial-title"/>
          <text macro="source-serial-identifier"/>
        </else-if>
        <else>
          <group delimiter=" ">
            <text macro="source-serial-title"/>
            <text macro="source-serial-identifier"/>
          </group>
        </else>
      </choose>
    </group>
  </macro>
  <!-- Serial source title -->
  <macro name="source-serial-name">
    <group delimiter=", ">
      <group delimiter=" ">
        <text font-style="italic" text-case="title" variable="container-title"/>
        <choose>
          <!-- TODO: remove conditional when Zotero stops double-mapping `event-place` and `publisher-place` -->
          <if match="none" variable="event-date event-title">
            <text prefix="(" suffix=")" variable="publisher-place"/>
          </if>
        </choose>
      </group>
      <choose>
        <if match="any" type="interview" variable="interviewer">
          <!-- publisher possible with `interview` (cf. CMOS18 14.110) -->
          <text variable="publisher"/>
        </if>
      </choose>
    </group>
  </macro>
  <macro name="source-serial-title">
    <group delimiter=", ">
      <choose>
        <!-- Journal special issues and supplements (cf. CMOS18 14.77-78, MHRA4 7.4) -->
        <if match="none" variable="container-title"/>
        <else-if match="none" type="periodical" variable="supplement-number volume-title"/>
        <!-- TODO: use `container-genre` here once available to allow a custom description of the journal volume -->
        <else-if variable="supplement-number volume-title">
          <text term="supplement"/>
        </else-if>
        <else-if type="periodical" variable="supplement-number title">
          <text term="supplement"/>
        </else-if>
        <else-if variable="volume-title">
          <text term="special-issue"/>
        </else-if>
        <else-if type="periodical" variable="title">
          <text term="special-issue"/>
        </else-if>
      </choose>
      <group delimiter=" ">
        <choose>
          <if match="none" variable="container-title"/>
          <else-if match="any" type="periodical" variable="supplement-number volume-title"/>
          <else-if match="any" type="review review-book" variable="reviewed-author reviewed-genre reviewed-title">
            <text term="in"/>
          </else-if>
        </choose>
        <text macro="source-serial-name"/>
      </group>
    </group>
  </macro>
  <macro name="source-serial-title-volume">
    <choose>
      <if variable="volume-title">
        <!-- Journal special issues (cf. CMOS18 14.77) and supplements (cf. CMOS18 14.78) -->
        <group delimiter=", ">
          <group delimiter=" ">
            <text term="in"/>
            <group delimiter=", ">
              <text macro="source-monographic-author"/>
              <text font-style="italic" text-case="title" variable="volume-title"/>
            </group>
          </group>
        </group>
      </if>
    </choose>
  </macro>
  <!-- Serial source identifier -->
  <macro name="source-serial-identifier">
    <group delimiter=", ">
      <text macro="source-serial-identifier-volume"/>
      <!-- periodical edition always capitalized (cf. CMOS18 14.89) -->
      <text macro="label-edition-capitalized"/>
      <text macro="source-serial-locator"/>
      <!-- for OGS: -->
      <!-- <text macro="source-serial-locator-range"/> -->
    </group>
  </macro>
  <macro name="source-serial-identifier-volume">
    <group delimiter=", ">
      <!-- `collection-title` is for any serial with multiple series (e.g. 'second series') -->
      <text variable="collection-title"/>
      <choose>
        <if type="article-newspaper">
          <!-- newspapers cited by date (NHR 18.3.3) -->
          <text macro="source-serial-volume-status" prefix="(" suffix=")"/>
        </if>
        <else-if match="any" variable="issue supplement-number volume">
          <group delimiter=" ">
            <group delimiter=", ">
              <choose>
                <if variable="issue volume">
                  <group delimiter="/">
                    <text variable="volume"/>
                    <!-- for original Hart's Rules or other options with Roman volume numbers for serials (as shown in NHR 18.1.3) -->
                    <!-- <text macro="label-volume"/> -->
                    <text variable="issue"/>
                  </group>
                </if>
                <else>
                  <text variable="volume"/>
                  <text macro="label-issue"/>
                </else>
              </choose>
              <text macro="label-supplement-number"/>
            </group>
            <text macro="source-date" prefix="(" suffix=")"/>
          </group>
        </else-if>
        <else-if variable="container-title">
          <text macro="source-serial-volume-status" prefix="(" suffix=")"/>
        </else-if>
        <else-if type="interview" variable="publisher">
          <text macro="source-serial-volume-status" prefix="(" suffix=")"/>
        </else-if>
        <else>
          <text macro="source-serial-volume-status"/>
        </else>
      </choose>
    </group>
  </macro>
  <macro name="source-serial-volume-status">
    <group delimiter=", ">
      <choose>
        <if match="none" variable="issue number page supplement-number volume">
          <group delimiter=" ">
            <!-- article accepted for publication and available on publisher website (cf. CMOS18 14.75) -->
            <!-- TODO: use CSL term for `available-date` when available -->
            <text value="accepted"/>
            <date form="text" variable="available-date"/>
          </group>
        </if>
      </choose>
      <group delimiter=" ">
        <text macro="source-date-status"/>
        <text macro="source-date"/>
      </group>
    </group>
  </macro>
  <!-- Serial source locator -->
  <macro name="source-serial-locator">
    <choose>
      <if match="any" variable="locator number">
        <group delimiter=", ">
          <text macro="label-locator"/>
          <!-- `number` is an article ID (cf. CMOS18 14.71) -->
          <text macro="label-number-article"/>
        </group>
      </if>
      <else>
        <text variable="page"/>
      </else>
    </choose>
  </macro>
  <macro name="source-serial-locator-range">
    <choose>
      <if match="any" variable="locator number">
        <group delimiter=", ">
          <group delimiter=" ">
            <choose>
              <if variable="page">
                <text variable="page"/>
                <text term="at"/>
              </if>
            </choose>
            <text macro="label-locator"/>
          </group>
          <!-- `number` is an article ID (cf. CMOS18 14.71) -->
          <text macro="label-number-article"/>
        </group>
      </if>
      <else>
        <text variable="page"/>
      </else>
    </choose>
  </macro>
  <!-- 4.2. Monographic sources -->
  <macro name="source-monographic">
    <group delimiter=", ">
      <!-- Monographic sources repeat main reference elements -->
      <choose>
        <if variable="container-title">
          <group delimiter=", ">
            <group delimiter=" ">
              <text macro="source-monographic-preposition"/>
              <group delimiter=", ">
                <text macro="source-monographic-author"/>
                <text macro="source-monographic-title"/>
              </group>
            </group>
            <text macro="source-monographic-description"/>
            <text macro="source-monographic-identifier"/>
          </group>
        </if>
      </choose>
      <!-- remove `source-series` for OGS: -->
      <text macro="source-series"/>
      <text macro="source-event"/>
    </group>
  </macro>
  <!-- Monographic source title -->
  <macro name="source-monographic-preposition">
    <choose>
      <if match="any" type="broadcast motion_picture"/>
      <else-if variable="chapter-number page title">
        <text term="in"/>
      </else-if>
      <else-if variable="chapter-number title">
        <group delimiter=" ">
          <text macro="label-chapter-number"/>
          <text term="in"/>
        </group>
      </else-if>
      <else>
        <text term="in"/>
      </else>
    </choose>
  </macro>
  <macro name="source-monographic-author">
    <!-- based on `author-note` -->
    <names variable="container-author">
      <name delimiter-precedes-last="contextual"/>
      <label form="short" prefix=", "/>
      <substitute>
        <names variable="author"/>
        <names variable="guest"/>
        <names variable="host"/>
        <choose>
          <if type="song">
            <names variable="performer"/>
          </if>
        </choose>
        <names variable="illustrator"/>
        <choose>
          <if match="none" type="classic performance standard">
            <names variable="editor-translator"/>
            <names variable="editor"/>
            <names variable="translator"/>
            <names variable="collection-editor"/>
          </if>
        </choose>
        <names variable="director"/>
        <choose>
          <!-- serial `broadcast` prioritizes title (cf. CMOS18 14.165, 14.168) -->
          <if type="broadcast" variable="container-title number title"/>
          <else>
            <names variable="producer"/>
            <names variable="executive-producer"/>
            <names variable="series-creator"/>
            <choose>
              <if type="broadcast">
                <names variable="contributor"/>
              </if>
            </choose>
          </else>
        </choose>
        <names variable="editorial-director"/>
        <names variable="compiler"/>
        <choose>
          <if match="any" type="event performance speech">
            <names variable="chair"/>
            <names variable="organizer"/>
          </if>
        </choose>
        <names variable="curator"/>
      </substitute>
    </names>
  </macro>
  <macro name="source-monographic-title">
    <group delimiter=", ">
      <text font-style="italic" text-case="title" variable="container-title"/>
      <text macro="title-volume"/>
    </group>
  </macro>
  <!-- Monographic source description -->
  <macro name="source-monographic-description">
    <choose>
      <if match="any" type="event paper-conference performance speech">
        <!-- Conference presentations should describe the session unless published in a proceedings -->
        <choose>
          <if match="none" variable="collection-editor compiler editor editorial-director">
            <!-- serial usage -->
            <text macro="description-format"/>
          </if>
        </choose>
      </if>
      <else-if type="software">
        <!-- For entries in mobile app reference works, place description after `container-title` -->
        <text macro="description-format"/>
      </else-if>
      <else-if match="any" type="document report standard">
        <!-- For chapters in report, standards, and generic documents, place description after `container-title` -->
        <text macro="description-format"/>
      </else-if>
    </choose>
  </macro>
  <!-- Monographic source identifier -->
  <macro name="source-monographic-identifier">
    <!-- Based on `identifier` -->
    <choose>
      <if variable="container-title">
        <group delimiter=", ">
          <choose>
            <if match="none" type="broadcast graphic map motion_picture song">
              <!-- For audiovisual media, number information comes after `title`, not `container-title`; `song` places album catalogue `number` with `publisher` (cf. CMOS18 14.163-164) -->
              <text macro="identifier-number"/>
            </if>
          </choose>
          <text macro="label-version"/>
          <text macro="identifier-edition"/>
          <text macro="source-monographic-identifier-contributors"/>
          <text macro="identifier-volume"/>
        </group>
      </if>
    </choose>
  </macro>
  <macro name="source-monographic-identifier-contributors">
    <group delimiter=", ">
      <names variable="editor-translator">
        <label form="verb-short" suffix=" "/>
        <name/>
      </names>
      <names delimiter=", " variable="editor translator">
        <label form="verb-short" suffix=" "/>
        <name/>
      </names>
      <names variable="guest">
        <label form="verb" suffix=" "/>
        <name/>
      </names>
      <names variable="host">
        <label form="verb-short" suffix=" "/>
        <name/>
      </names>
      <names delimiter=", " variable="chair organizer">
        <label form="verb-short" suffix=" "/>
        <name/>
      </names>
      <names delimiter=", " variable="illustrator narrator compiler curator">
        <label form="verb-short" suffix=" "/>
        <name/>
      </names>
      <names delimiter=", " variable="series-creator executive-producer">
        <label form="verb" suffix=" "/>
        <name/>
      </names>
      <names variable="producer">
        <label form="verb-short" suffix=" "/>
        <name/>
      </names>
      <names variable="editorial-director">
        <label form="verb-short" suffix=" "/>
        <name/>
      </names>
      <names variable="director">
        <label form="verb-short" suffix=" "/>
        <name/>
      </names>
      <names variable="performer">
        <label form="verb-short" suffix=" "/>
        <name/>
      </names>
      <choose>
        <if type="song"/>
        <else-if type="thesis"/>
        <else>
          <!-- Song contributors attached to album (cf. CMOS18 14.163) -->
          <names variable="contributor">
            <label form="verb-short" suffix=" "/>
            <name/>
          </names>
        </else>
      </choose>
    </group>
  </macro>
  <!-- Monographic source locator -->
  <macro name="source-monographic-locator">
    <group delimiter=", ">
      <choose>
        <if match="any" variable="part-title volume-title"/>
        <else-if match="any" variable="locator page">
          <text macro="label-volume"/>
          <text macro="label-part-number"/>
        </else-if>
      </choose>
      <choose>
        <if variable="locator">
          <text macro="label-locator"/>
        </if>
        <else>
          <text variable="page"/>
        </else>
      </choose>
    </group>
  </macro>
  <macro name="source-monographic-locator-range">
    <group delimiter=". ">
      <!-- full stop is delimiter in Oxford Guide to Style; for NHR delimiter: -->
      <!-- <group delimiter=". " -->
      <choose>
        <if match="any" variable="part-title volume-title"/>
        <else-if match="any" variable="locator page">
          <text macro="label-volume"/>
          <text macro="label-part-number"/>
        </else-if>
      </choose>
      <choose>
        <if variable="locator">
          <group delimiter=" ">
            <choose>
              <if variable="page">
                <text variable="page"/>
                <text term="at"/>
              </if>
            </choose>
            <text macro="label-locator"/>
          </group>
        </if>
        <else>
          <text variable="page"/>
        </else>
      </choose>
    </group>
  </macro>
  <!-- 4.3. Series -->
  <macro name="source-series">
    <group delimiter=", ">
      <text text-case="title" variable="collection-title"/>
      <text variable="collection-number"/>
      <text macro="label-issue"/>
    </group>
  </macro>
  <!-- 4.4. Event -->
  <macro name="source-event">
    <group delimiter=" ">
      <choose>
        <!-- omit types that provide event information in description  -->
        <if match="any" type="interview" variable="interviewer"/>
        <else-if type="personal_communication" variable="recipient"/>
        <else-if match="any" type="review review-book" variable="reviewed-author reviewed-genre reviewed-title"/>
        <else-if match="any" variable="event event-date event-title">
          <!-- TODO: To prevent Zotero from printing `event-place`, due to its double-mapping of `publisher-place` and `event-place`. Remove this when that is changed. -->
          <choose>
            <if type="paper-conference">
              <choose>
                <if match="none" variable="collection-editor compiler editor editorial-director issue page supplement-number volume">
                  <!-- Don't print event info for conference papers published in proceedings -->
                  <text macro="source-event-status"/>
                  <text macro="source-event-description"/>
                </if>
              </choose>
            </if>
            <else>
              <!-- For other item types, print event info even if published (e.g. collection catalogues, performance programmes). -->
              <text macro="source-event-status"/>
              <text macro="source-event-description"/>
            </else>
          </choose>
        </else-if>
      </choose>
    </group>
  </macro>
  <macro name="source-event-place-first">
    <!-- for descriptive elements for interviews, reviews, letters -->
    <choose>
      <if match="any" variable="event event-date event-title">
        <group delimiter=", ">
          <text variable="event-title"/>
          <text variable="event-place"/>
          <text macro="date-event-full"/>
        </group>
      </if>
    </choose>
  </macro>
  <macro name="source-event-status">
    <group delimiter=" ">
      <choose>
        <if type="broadcast" variable="status">
          <!-- 'aired', 'performed', etc. (cf. CMOS18 14.165) -->
          <text variable="status"/>
        </if>
        <else-if type="paper-conference">
          <choose>
            <if variable="genre">
              <text value="delivered"/>
            </if>
            <else>
              <text form="short" term="paper-conference"/>
              <text value="delivered"/>
            </else>
          </choose>
          <choose>
            <if match="any" variable="event event-title">
              <text term="at"/>
            </if>
          </choose>
        </else-if>
        <else-if type="song">
          <text value="rec."/>
          <choose>
            <if variable="event-title">
              <text term="at"/>
            </if>
          </choose>
        </else-if>
        <else-if variable="event-date issued"/>
        <else-if match="none" variable="issued">
          <text variable="status"/>
        </else-if>
      </choose>
    </group>
  </macro>
  <macro name="source-event-title">
    <choose>
      <!-- TODO: We expect `event-title` to be used, but processors and applications may not be updated yet. This macro ensures that either `event` or `event-title` can be accepted. Remove if processor logic and application adoption can handle this. -->
      <if variable="event-title">
        <text variable="event-title"/>
      </if>
      <else>
        <text variable="event"/>
      </else>
    </choose>
  </macro>
  <macro name="source-event-title-capitalized">
    <choose>
      <!-- TODO: We expect `event-title` to be used, but processors and applications may not be updated yet. This macro ensures that either `event` or `event-title` can be accepted. Remove if processor logic and application adoption can handle this. -->
      <if variable="event-title">
        <text text-case="capitalize-first" variable="event-title"/>
      </if>
      <else>
        <text text-case="capitalize-first" variable="event"/>
      </else>
    </choose>
  </macro>
  <macro name="source-event-description">
    <group delimiter=", ">
      <text macro="source-event-title"/>
      <text macro="date-event-full"/>
      <text variable="event-place"/>
    </group>
  </macro>
  <!-- 4.5. Facts of publication -->
  <macro name="source-monographic-publication">
    <group delimiter="; ">
      <choose>
        <!-- Provide only for monographic types -->
        <if match="any" type="article-journal article-magazine article-newspaper periodical post-weblog review review-book"/>
        <else-if match="any" type="interview paper-conference">
          <choose>
            <if match="any" variable="collection-editor container-author editor editorial-director">
              <!-- monographic usage -->
              <!-- for OGS: -->
              <!-- <text macro="source-series"/> -->
              <text macro="source-publication-and-date"/>
            </if>
          </choose>
        </else-if>
        <!-- `patent` date in identification (cf. CMOS18 14.158) -->
        <else-if type="patent"/>
        <else>
          <!-- for OGS: -->
          <!-- <text macro="source-series"/> -->
          <text macro="source-publication-and-date"/>
        </else>
      </choose>
      <text macro="source-publication-original-title"/>
    </group>
  </macro>
  <macro name="source-monographic-publication-bracketed">
    <!-- Facts of publication with brackets for print monographic formats -->
    <choose>
      <if match="any" type="book broadcast chapter classic entry interview motion_picture musical_score pamphlet paper-conference report software song standard">
        <text macro="source-monographic-publication" prefix="(" suffix=")"/>
      </if>
      <else-if type="article" variable="genre publisher">
        <!-- without brackets for a preprint in a repository (cf. CMOS18 14.76), with brackets for a working paper (cf. CMOS18 14.116) -->
        <text macro="source-monographic-publication" prefix="(" suffix=")"/>
      </else-if>
      <!-- dictionary/encyclopedia entries probably are bracketed only with publisher (cf. MHRA4 7.5) -->
      <else-if type="entry-dictionary" variable="publisher">
        <text macro="source-monographic-publication" prefix="(" suffix=")"/>
      </else-if>
      <else-if type="entry-encyclopedia" variable="publisher">
        <text macro="source-monographic-publication" prefix="(" suffix=")"/>
      </else-if>
      <else-if type="personal_communication">
        <choose>
          <if match="any" variable="collection-editor compiler editor editorial-director publisher">
            <!-- in an edited collection -->
            <text macro="source-monographic-publication" prefix="(" suffix=")"/>
          </if>
        </choose>
      </else-if>
    </choose>
  </macro>
  <macro name="source-monographic-publication-unbracketed">
    <!-- Facts of publication without brackets -->
    <choose>
      <if match="any" type="book broadcast chapter classic entry interview motion_picture musical_score pamphlet paper-conference report software song standard"/>
      <else-if type="article" variable="genre publisher"/>
      <else-if type="entry-dictionary" variable="publisher"/>
      <else-if type="entry-encyclopedia" variable="publisher"/>
      <else-if type="personal_communication">
        <choose>
          <if match="none" variable="collection-editor compiler editor editorial-director publisher">
            <!-- not in an edited collection -->
            <text macro="source-monographic-publication"/>
          </if>
        </choose>
      </else-if>
      <else>
        <text macro="source-monographic-publication"/>
      </else>
    </choose>
  </macro>
  <macro name="source-monographic-publication-short-bracketed">
    <!-- mirrors `source-monographic-publication-bracketed` -->
    <choose>
      <if disambiguate="true">
        <group delimiter=", " prefix="(" suffix=")">
          <choose>
            <!-- Facts of publication with brackets for print monographic formats -->
            <if match="any" type="book chapter classic entry entry-dictionary entry-encyclopedia interview musical_score pamphlet paper-conference report thesis">
              <choose>
                <if disambiguate="true">
                  <text macro="source-publication-publisher"/>
                </if>
              </choose>
              <text macro="source-date"/>
            </if>
            <else-if type="article" variable="genre publisher">
              <!-- without brackets for a preprint in a repository (cf. CMOS18 14.76), with brackets for a working paper (cf. CMOS18 14.116) -->
              <choose>
                <if disambiguate="true">
                  <text macro="source-publication-publisher"/>
                </if>
              </choose>
              <text macro="source-date"/>
            </else-if>
            <else-if type="motion_picture" variable="publisher">
              <choose>
                <if disambiguate="true">
                  <text macro="source-publication-publisher"/>
                </if>
              </choose>
              <text macro="source-date"/>
            </else-if>
            <else-if type="personal_communication">
              <choose>
                <if match="any" variable="collection-editor compiler editor editorial-director publisher">
                  <!-- in an edited collection -->
                  <text macro="source-date"/>
                </if>
              </choose>
            </else-if>
          </choose>
        </group>
      </if>
    </choose>
  </macro>
  <macro name="source-monographic-publication-short-unbracketed">
    <!-- mirrors `source-monographic-publication-unbracketed` -->
    <choose>
      <if disambiguate="true">
        <choose>
          <!-- Facts of publication without brackets -->
          <if match="any" type="book chapter classic entry entry-dictionary entry-encyclopedia interview musical_score pamphlet paper-conference report thesis"/>
          <else-if type="article" variable="genre publisher"/>
          <else-if type="motion_picture" variable="publisher"/>
          <else-if type="personal_communication">
            <choose>
              <if match="none" variable="collection-editor compiler editor editorial-director publisher">
                <!-- not in an edited collection -->
                <text macro="source-date"/>
              </if>
            </choose>
          </else-if>
          <else>
            <text macro="source-date"/>
          </else>
        </choose>
      </if>
    </choose>
  </macro>
  <macro name="source-publication-and-date">
    <group delimiter=", ">
      <choose>
        <if match="any" type="post webpage">
          <!-- `container-title` functions like a publisher with social media and website sources (cf. CMOS18 14.104-106) -->
          <text text-case="title" variable="container-title"/>
        </if>
      </choose>
      <text macro="source-publication-history"/>
      <group delimiter=" ">
        <text macro="source-date-status"/>
        <text macro="source-date"/>
      </group>
    </group>
  </macro>
  <!-- Facts of publication elements -->
  <macro name="source-publication-description">
    <choose>
      <if type="article" variable="genre"/>
      <else-if type="article">
        <!-- `preprint` term attached to repository name, but specific working paper descriptors appear in description (cf. CMOS18 14.76, 14.116) -->
        <text term="preprint"/>
      </else-if>
      <else-if type="thesis">
        <!-- thesis type appears with university name (cf. MHRA4 7.10) -->
        <text macro="description-format"/>
      </else-if>
      <else-if match="any" variable="original-publisher original-publisher-place">
        <choose>
          <!-- `edition` provides an alternative label to `reprint` (cf. CMOS18 14.16) -->
          <if match="any" variable="edition original-title"/>
          <else-if match="none" type="book chapter classic entry entry-dictionary entry-encyclopedia interview musical_score pamphlet paper-conference report thesis"/>
          <else-if variable="issued original-date">
            <text value="repr."/>
          </else-if>
        </choose>
      </else-if>
    </choose>
  </macro>
  <macro name="source-publication-history">
    <choose>
      <if variable="original-title">
        <!-- `original-title` is covered in `source-publication-original-title-bib` -->
        <group delimiter=", ">
          <text macro="source-publication-description"/>
          <choose>
            <if match="none" variable="editor">
              <text macro="label-edition"/>
            </if>
          </choose>
          <text macro="source-publication-publisher"/>
        </group>
      </if>
      <else>
        <group delimiter="; ">
          <group delimiter=", ">
            <text macro="source-publication-publisher-original"/>
            <text macro="source-date-original"/>
          </group>
          <group delimiter=", ">
            <choose>
              <if variable="original-date">
                <text macro="label-edition"/>
              </if>
              <else-if variable="editor"/>
              <else>
                <text macro="label-edition"/>
              </else>
            </choose>
            <group delimiter=", ">
              <text macro="source-publication-description"/>
              <text macro="source-publication-publisher"/>
            </group>
          </group>
        </group>
      </else>
    </choose>
  </macro>
  <macro name="source-publication-original-title">
    <!-- Work originally published under a different title (cf. CMOS18 13.101) -->
    <choose>
      <if variable="original-title">
        <group delimiter=" ">
          <text form="short" term="original-work-published"/>
          <choose>
            <if match="none" variable="original-author">
              <text value="as"/>
            </if>
          </choose>
          <group delimiter=", ">
            <names variable="original-author"/>
            <text font-style="italic" text-case="title" variable="original-title"/>
          </group>
          <group delimiter=", " prefix="[" suffix="]">
            <text macro="source-publication-publisher-original"/>
            <text macro="source-date-original"/>
          </group>
        </group>
      </if>
    </choose>
  </macro>
  <macro name="source-publication-publisher">
    <group delimiter=" ">
      <choose>
        <if match="any" type="book chapter classic entry entry-dictionary entry-encyclopedia interview musical_score pamphlet paper-conference report">
          <group delimiter=": ">
            <choose>
              <if variable="publisher-place">
                <text variable="publisher-place"/>
              </if>
              <else-if match="none" type="classic entry entry-dictionary entry-encyclopedia" variable="original-publisher-place">
                <text form="short" term="no-place"/>
              </else-if>
            </choose>
            <!-- <text variable="publisher"/> -->
          </group>
        </if>
        <else>
          <text variable="publisher"/>
        </else>
      </choose>
      <choose>
        <if type="song">
          <!-- Album catalogue number follows label name (NHR 18.7.2; cf. CMOS18 14.163–164) -->
          <text variable="number"/>
        </if>
      </choose>
    </group>
  </macro>
  <macro name="source-publication-publisher-original">
    <choose>
      <if match="any" type="book chapter classic entry entry-dictionary entry-encyclopedia interview musical_score pamphlet paper-conference report">
        <group delimiter=": ">
          <text variable="original-publisher-place"/>
          <!-- <text variable="original-publisher"/> -->
        </group>
      </if>
      <else>
        <text variable="original-publisher"/>
      </else>
    </choose>
  </macro>
  <!-- 4.6. Date -->
  <macro name="source-date">
    <text macro="source-date-issued-or-status"/>
    <!-- for author-date: -->
    <!-- <text macro="source-date-issued-day-month"/> -->
  </macro>
  <!-- Date elements -->
  <macro name="source-date-issued-full">
    <!-- Give full date for more ephemeral types; reflected in `date-year-sort` -->
    <!-- NB: any changes must also be applied to `source-date-original-full` -->
    <choose>
      <if type="personal_communication" variable="event-date issued">
        <!-- Provide issue date for letters listed under event-date -->
        <text macro="date-issued-year"/>
      </if>
      <else-if match="any" type="article-journal article-magazine article-newspaper periodical post-weblog review review-book">
        <text macro="source-date-issued-full-serial"/>
      </else-if>
      <else-if match="any" type="interview paper-conference">
        <choose>
          <if match="any" variable="collection-editor compiler editor editorial-director">
            <!-- monographic usage -->
            <text macro="date-issued-year"/>
          </if>
          <else>
            <!-- serial usage -->
            <text macro="source-date-issued-full-serial"/>
          </else>
        </choose>
      </else-if>
      <else-if match="any" type="entry entry-dictionary entry-encyclopedia">
        <choose>
          <if match="any" variable="DOI URL">
            <!-- Online reference works use full dates (cf. CMOS18 14.131) -->
            <text macro="date-issued-full"/>
          </if>
          <else>
            <text macro="date-issued-year"/>
          </else>
        </choose>
      </else-if>
      <else-if match="any" type="article broadcast collection dataset document event graphic interview manuscript map patent performance personal_communication post software speech standard webpage">
        <text macro="date-issued-full"/>
      </else-if>
      <else-if variable="issued">
        <text macro="date-issued-year"/>
      </else-if>
      <else-if variable="available-date">
        <!-- possible recourse for multivolume series (e.g. CMOS18 14.26) -->
        <date date-parts="year" form="text" variable="available-date"/>
      </else-if>
      <else-if variable="event-date">
        <text macro="date-event-year"/>
      </else-if>
    </choose>
  </macro>
  <macro name="source-date-issued-full-serial">
    <choose>
      <if type="article-newspaper">
        <text macro="date-issued-full"/>
      </if>
      <else-if match="any" variable="supplement-number volume">
        <text macro="date-issued-year"/>
      </else-if>
      <else-if variable="issue">
        <text macro="date-issued-year-month"/>
      </else-if>
      <else>
        <text macro="date-issued-full"/>
      </else>
    </choose>
  </macro>
  <macro name="source-date-issued-day-month">
    <!-- Variant for author-date styles -->
    <!-- Give full date for more ephemeral types; reflected in `date-year-sort` -->
    <!-- NB: any changes must also be applied to `date-year-sort` and `source-date-original-day-month` -->
    <choose>
      <if type="personal_communication" variable="event-date issued">
        <!-- Provide issue date for letters listed under event-date -->
        <text macro="date-issued-year"/>
      </if>
      <else-if match="any" type="article-journal article-magazine article-newspaper periodical post-weblog review review-book">
        <text macro="source-date-issued-day-month-serial"/>
      </else-if>
      <else-if match="any" type="interview paper-conference">
        <choose>
          <if match="none" variable="collection-editor compiler editor editorial-director">
            <!-- serial usage -->
            <text macro="source-date-issued-day-month-serial"/>
          </if>
        </choose>
      </else-if>
      <else-if match="any" type="entry entry-dictionary entry-encyclopedia">
        <choose>
          <if match="any" variable="DOI URL">
            <!-- Online reference works use full dates (cf. CMOS18 14.131) -->
            <text macro="date-issued-day-month"/>
          </if>
        </choose>
      </else-if>
      <else-if match="any" type="article broadcast collection dataset document event graphic interview manuscript map patent performance personal_communication post software speech standard webpage">
        <text macro="date-issued-day-month"/>
      </else-if>
    </choose>
  </macro>
  <macro name="source-date-issued-day-month-serial">
    <choose>
      <if type="article-newspaper">
        <text macro="date-issued-day-month"/>
      </if>
      <else-if match="any" variable="supplement-number volume"/>
      <else-if variable="issue">
        <text macro="date-issued-month"/>
      </else-if>
      <else>
        <text macro="date-issued-day-month"/>
      </else>
    </choose>
  </macro>
  <macro name="source-date-issued-or-status">
    <choose>
      <if match="any" variable="event-date issued">
        <text macro="source-date-issued-full"/>
      </if>
      <else-if variable="status">
        <text text-case="lowercase" variable="status"/>
      </else-if>
      <else-if match="any" type="interview personal_communication">
        <choose>
          <if match="any" variable="archive archive-place container-title DOI number publisher references URL">
            <!-- only give n.d. for accessible personal communication (cf. CMOS18 14.111)-->
            <text form="short" term="no date"/>
          </if>
        </choose>
      </else-if>
      <!-- no n.d. for `classic` (cf. MHRA4 7.3c) or manuscripts (NHR 18.6.2) -->
      <else-if match="any" type="classic manuscript"/>
      <else>
        <text form="short" term="no date"/>
      </else>
    </choose>
  </macro>
  <macro name="source-date-original">
    <text macro="source-date-original-full"/>
    <!-- for author-date: -->
    <!-- <text macro="source-date-original-day-month"/> -->
  </macro>
  <macro name="source-date-original-full">
    <!-- Give full date for more ephemeral types; reflected in `date-year-sort` -->
    <!-- Macro derived from `source-date-issued-full` -->
    <choose>
      <if type="personal_communication" variable="event-date original-date">
        <!-- Provide original date for letters listed under event-date -->
        <text macro="date-original-year"/>
      </if>
      <else-if match="any" type="article-journal article-magazine article-newspaper periodical post-weblog review review-book">
        <text macro="source-date-original-full-serial"/>
      </else-if>
      <else-if match="any" type="interview paper-conference">
        <choose>
          <if match="any" variable="collection-editor compiler editor editorial-director">
            <!-- monographic usage -->
            <text macro="date-original-year"/>
          </if>
          <else>
            <!-- serial usage -->
            <text macro="source-date-original-full-serial"/>
          </else>
        </choose>
      </else-if>
      <else-if match="any" type="entry entry-dictionary entry-encyclopedia">
        <choose>
          <if match="any" variable="DOI URL">
            <!-- Online reference works use full dates (cf. CMOS18 14.131) -->
            <text macro="date-original-full"/>
          </if>
          <else>
            <text macro="date-original-year"/>
          </else>
        </choose>
      </else-if>
      <else-if match="any" type="article broadcast collection dataset document event graphic interview manuscript map patent performance personal_communication post software speech standard webpage">
        <text macro="date-original-full"/>
      </else-if>
      <else>
        <text macro="date-original-year"/>
      </else>
    </choose>
  </macro>
  <macro name="source-date-original-full-serial">
    <choose>
      <if type="article-newspaper">
        <text macro="date-original-full"/>
      </if>
      <else-if match="any" variable="supplement-number volume">
        <text macro="date-original-year"/>
      </else-if>
      <else-if variable="issue">
        <text macro="date-original-year-month"/>
      </else-if>
      <else>
        <text macro="date-original-full"/>
      </else>
    </choose>
  </macro>
  <macro name="source-date-original-day-month">
    <!-- Give full date for more ephemeral types; reflected in `date-year-sort` -->
    <!-- Macro derived from `source-date-issued-day-month` -->
    <choose>
      <if type="personal_communication" variable="event-date original-date">
        <!-- Provide original date for letters listed under event-date -->
        <text macro="date-original-year"/>
      </if>
      <else-if match="any" type="article-journal article-magazine article-newspaper periodical post-weblog review review-book">
        <text macro="source-date-original-day-month-serial"/>
      </else-if>
      <else-if match="any" type="interview paper-conference">
        <choose>
          <if match="none" variable="collection-editor compiler editor editorial-director">
            <!-- serial usage -->
            <text macro="source-date-original-day-month-serial"/>
          </if>
        </choose>
      </else-if>
      <else-if match="any" type="entry entry-dictionary entry-encyclopedia">
        <choose>
          <if match="any" variable="DOI URL">
            <!-- Online reference works use full dates (cf. CMOS18 14.131) -->
            <text macro="date-original-day-month"/>
          </if>
        </choose>
      </else-if>
      <else-if match="any" type="article broadcast collection dataset document event graphic interview manuscript map patent performance personal_communication post software speech standard webpage">
        <text macro="date-original-day-month"/>
      </else-if>
    </choose>
  </macro>
  <macro name="source-date-original-day-month-serial">
    <choose>
      <if type="article-newspaper">
        <text macro="date-original-day-month"/>
      </if>
      <else-if match="any" variable="supplement-number volume"/>
      <else-if variable="issue">
        <text macro="date-original-month"/>
      </else-if>
      <else>
        <text macro="date-original-day-month"/>
      </else>
    </choose>
  </macro>
  <macro name="source-date-status">
    <choose>
      <if type="broadcast" variable="event-title issued status"/>
      <!-- on a `broadcast`, if there is an `event-title`, `status` appears with `event-date` as part of `source-event` (cf. CMOS18 14.165) -->
      <else-if variable="issued status">
        <!-- `status` specifies date type, e.g. 'effective', 'last modified', 'approved' (cf. CMOS18 14.104 for `webpage`; CMOS18 14.159 for `standard`) -->
        <text variable="status"/>
      </else-if>
      <!-- 'published online' for a work available ahead of print (cf. MHRA4 7.4) -->
      <else-if match="any" variable="available-date collection-title issue number page status supplement-number volume"/>
      <else-if type="article-journal" variable="DOI issued">
        <text term="advance-online-publication"/>
      </else-if>
    </choose>
  </macro>
  <!-- 4.7. Locator (including page references) -->
  <macro name="source-locator-subsequent">
    <choose>
      <if match="any" type="article-journal article-magazine article-newspaper periodical post-weblog review review-book">
        <text macro="source-locator-subsequent-serial"/>
      </if>
      <else-if match="any" type="interview paper-conference">
        <choose>
          <if match="any" variable="collection-editor compiler editor editorial-director">
            <!-- monographic usage -->
            <text macro="source-locator-subsequent-monographic"/>
          </if>
          <else>
            <!-- serial usage -->
            <text macro="source-locator-subsequent-serial"/>
          </else>
        </choose>
      </else-if>
      <else>
        <text macro="source-locator-subsequent-monographic"/>
      </else>
    </choose>
  </macro>
  <macro name="source-locator-subsequent-monographic">
    <group delimiter=", ">
      <choose>
        <if variable="container-title">
          <!-- Do not provide `volume` or `part-number` for defined section -->
          <text macro="label-locator"/>
        </if>
        <else>
          <text macro="label-volume"/>
          <text macro="label-part-number"/>
          <text macro="label-locator"/>
        </else>
      </choose>
    </group>
  </macro>
  <macro name="source-locator-subsequent-serial">
    <group delimiter=", ">
      <text macro="label-part-number"/>
      <text macro="label-locator"/>
    </group>
  </macro>
  <!-- 4.8. Medium -->
  <macro name="source-medium">
    <!-- the medium appears at both the title and container levels, and both with and without brackets (NHR 18.7.2–3, 18.8.5) -->
    <group delimiter=", ">
      <text variable="medium"/>
      <text variable="scale"/>
      <text variable="dimensions"/>
    </group>
  </macro>
  <!-- 4.9. Archival location -->
  <macro name="source-archive">
    <group delimiter=", ">
      <text variable="archive-place"/>
      <text variable="archive"/>
      <!-- either `archive`, `archive-place` or `archive-place`, `archive` (NHR 18.6.5; the latter matches OGS 15.11.1 and MHRA4 7.7) -->
      <text variable="archive_collection"/>
      <text variable="archive_location"/>
    </group>
  </macro>
  <macro name="source-archive-short">
    <!-- shortened reference for an item consisting only of a shelfmark (cf. MHRA4 7.7) -->
    <group delimiter=", ">
      <choose>
        <if match="none" variable="archive_collection">
          <text form="short" variable="archive"/>
        </if>
      </choose>
      <text variable="archive_collection"/>
      <text variable="archive_location"/>
    </group>
  </macro>
  <!-- 4.10. DOI or URL -->
  <macro name="source-DOI-URL">
    <choose>
      <if variable="DOI">
        <text prefix="https://doi.org/" variable="DOI"/>
      </if>
      <else-if variable="URL">
        <group delimiter=", ">
          <choose>
            <if match="none" variable="available-date event-date issued status">
              <group delimiter=" ">
                <text term="accessed"/>
                <date form="text" variable="accessed"/>
              </group>
            </if>
          </choose>
          <text variable="URL"/>
        </group>
      </else-if>
    </choose>
  </macro>
  <!-- Citation -->
  <macro name="citation-author-date">
    <!-- more detail in Oxford Guide to Style, sect. 15.19 -->
    <!-- Usage:
    
    <citation after-collapse-delimiter="; " collapse="year" disambiguate-add-givenname="true" disambiguate-add-names="true" disambiguate-add-year-suffix="true">
      <layout delimiter="; " prefix="(" suffix=")">
        <text macro="citation-author-date"/>
      </layout>
    </citation>
    -->
    <group delimiter=": ">
      <group delimiter=", ">
        <choose>
          <if type="classic">
            <text macro="author-inline"/>
            <choose>
              <if variable="author">
                <text macro="title-and-descriptions-short"/>
              </if>
            </choose>
          </if>
          <else-if match="any" variable="event-date issued">
            <choose>
              <if match="any" type="interview personal_communication">
                <choose>
                  <if match="any" variable="archive archive-place container-title DOI number publisher references URL">
                    <group delimiter=" ">
                      <text macro="author-inline"/>
                      <text macro="date-short"/>
                    </group>
                  </if>
                  <else>
                    <!-- unpublished `interview` or `personal_communication` use inline format (NHR 17.3.2) -->
                    <text macro="author-inline"/>
                    <text macro="title-and-descriptions-short"/>
                    <text macro="date-short"/>
                  </else>
                </choose>
              </if>
              <else>
                <group delimiter=" ">
                  <text macro="author-inline"/>
                  <text macro="date-short"/>
                </group>
              </else>
            </choose>
          </else-if>
          <else>
            <!--- Comma with forthcoming or n.d. -->
            <text macro="author-inline"/>
            <choose>
              <if match="any" type="interview personal_communication">
                <choose>
                  <if match="none" variable="archive archive-place container-title DOI number publisher references URL">
                    <!-- unpublished `interview` or `personal_communication` use inline format (NHR 17.3.2) -->
                    <text macro="title-and-descriptions-short"/>
                  </if>
                </choose>
              </if>
            </choose>
            <text macro="date-short"/>
          </else>
        </choose>
      </group>
      <text macro="label-locator"/>
    </group>
  </macro>
  <macro name="citation-notes-full-subsequent-author-title">
    <choose>
      <if position="subsequent">
        <group delimiter=", ">
          <text macro="citation-notes-shortened-author-title-item"/>
          <text macro="source-locator-subsequent"/>
        </group>
      </if>
      <else>
        <group delimiter=", ">
          <text macro="author-note"/>
          <text macro="title-and-source"/>
        </group>
      </else>
    </choose>
  </macro>
  <macro name="citation-notes-full-subsequent-ibid">
    <choose>
      <if position="ibid-with-locator">
        <group delimiter=", ">
          <text term="ibid"/>
          <text macro="source-locator-subsequent"/>
        </group>
      </if>
      <else-if position="ibid">
        <text term="ibid"/>
      </else-if>
      <else-if position="subsequent">
        <group delimiter=", ">
          <text macro="citation-notes-shortened-author-title-item"/>
          <text macro="source-locator-subsequent"/>
        </group>
      </else-if>
      <else>
        <group delimiter=", ">
          <text macro="author-note"/>
          <text macro="title-and-source"/>
        </group>
      </else>
    </choose>
  </macro>
  <macro name="citation-notes-shortened-author-title">
    <!-- Shortened note styles mirror the filtering approach of author-date -->
    <group delimiter=", ">
      <text macro="citation-notes-shortened-author-title-item"/>
      <text macro="source-locator-subsequent"/>
    </group>
  </macro>
  <macro name="citation-notes-shortened-author-title-item">
    <group delimiter=" ">
      <group delimiter=", ">
        <text macro="author-short"/>
        <text macro="title-and-descriptions-short"/>
        <text macro="citation-notes-shortened-author-title-disambiguate"/>
        <choose>
          <if match="any" type="interview personal_communication">
            <choose>
              <if match="none" variable="archive archive-place container-title DOI number publisher references URL">
                <!-- unpublished `interview` or `personal_communication` use inline format (NHR 17.3.2) -->
                <text macro="date-short"/>
              </if>
            </choose>
          </if>
        </choose>
        <text macro="source-monographic-publication-short-unbracketed"/>
      </group>
      <text macro="source-monographic-publication-short-bracketed"/>
    </group>
  </macro>
  <macro name="citation-notes-shortened-author-title-disambiguate">
    <!-- added dates, editors/translators, publisher, date -->
    <group delimiter=", ">
      <choose>
        <if disambiguate="true">
          <names variable="editor-translator">
            <label form="verb-short" suffix=" "/>
            <name form="short"/>
            <substitute>
              <names variable="editor"/>
              <names variable="translator"/>
            </substitute>
          </names>
          <choose>
            <if disambiguate="true">
              <text macro="label-version"/>
              <text macro="label-edition"/>
            </if>
          </choose>
        </if>
      </choose>
    </group>
  </macro>
  <citation disambiguate-add-givenname="true" disambiguate-add-names="true">
    <layout delimiter="; " suffix=".">
      <text macro="citation-notes-full-subsequent-author-title"/>
    </layout>
  </citation>
  <!-- Bibliography -->
  <macro name="bibliography-author-date">
    <group delimiter=". ">
      <group delimiter=" ">
        <text macro="author-bib"/>
        <group delimiter=", ">
          <text macro="date"/>
          <text macro="title-and-source"/>
        </group>
      </group>
      <text variable="references"/>
    </group>
  </macro>
  <macro name="bibliography-notes">
    <group delimiter=". ">
      <group delimiter=", ">
        <text macro="author-bib"/>
        <text macro="title-and-source"/>
      </group>
      <text variable="references"/>
    </group>
  </macro>
  <macro name="bibliography-filtered-author-date">
    <!-- MHRA4 does not provide specific guidance on excluding citations from the bibliography (cf. MHRA4 8.3), but this seems to be the intent, as some of its examples are only usable in a note; this macro follows guidance in NHR and CMOS. -->
    <!-- usage:
     <sort>
      <key macro="author-bib"/>
      <key macro="date-sort-group"/>
      <key macro="date-sort-year"/>
      <key variable="status"/>
      <key macro="title"/>
      <key variable="volume"/>
      <key variable="part-number"/>
      <key macro="source-archive"/>
     </sort>
     <layout suffix=".">
       <text macro="bibliography-filtered-author-date"/>
     </layout>
    -->
    <choose>
      <if type="classic">
        <choose>
          <if match="any" variable="archive editor translator publisher">
            <text macro="bibliography-author-date"/>
          </if>
        </choose>
      </if>
      <else-if match="any" type="entry entry-dictionary entry-encyclopedia">
        <choose>
          <if variable="author">
            <!-- Only signed reference entries appear in the bibliography (cf. CMOS18 14.132) -->
            <text macro="bibliography-author-date"/>
          </if>
          <else-if match="any" variable="DOI URL">
            <!-- Provide a bibliography if necessary identifying information is not in text -->
            <text macro="bibliography-author-date"/>
          </else-if>
        </choose>
      </else-if>
      <else-if match="any" type="interview personal_communication">
        <choose>
          <if match="any" variable="archive archive-place container-title DOI number publisher references URL">
            <!-- Personal communications only appear in the bibliography if the reader can retrieve them (NHR 17.3.2; cf. CMOS18 14.13, 14.111) -->
            <text macro="bibliography-author-date"/>
          </if>
        </choose>
      </else-if>
      <else>
        <text macro="bibliography-author-date"/>
      </else>
    </choose>
  </macro>
  <macro name="bibliography-filtered-notes">
    <choose>
      <if type="classic">
        <choose>
          <if match="any" variable="archive editor translator publisher">
            <text macro="bibliography-notes"/>
          </if>
        </choose>
      </if>
      <else-if match="any" type="entry entry-dictionary entry-encyclopedia">
        <choose>
          <if variable="author">
            <!-- Only signed reference entries appear in the bibliography (cf. CMOS18 14.132) -->
            <text macro="bibliography-notes"/>
          </if>
        </choose>
      </else-if>
      <else-if match="any" type="interview personal_communication">
        <!-- Personal communications only appear in the bibliography if the reader can retrieve them (NHR 17.3.2; cf. CMOS18 14.13, 14.111) -->
        <choose>
          <if match="any" variable="archive archive-place container-title DOI number publisher references URL">
            <text macro="bibliography-notes"/>
          </if>
        </choose>
      </else-if>
      <else-if match="any" type="document manuscript paper-conference speech">
        <!-- In note styles, the bibliography also omits inaccessible manuscripts (NHR 18.3.1; cf. CMOS18 14.114), conference papers (cf. CMOS18 14.115), and private documents (cf. CMOS18 14.118) -->
        <choose>
          <if match="any" variable="archive archive-place container-title DOI number publisher references URL">
            <text macro="bibliography-notes"/>
          </if>
        </choose>
      </else-if>
      <!-- social media content usually omitted from the bibliography (cf. CMOS18 14.106) -->
      <else-if type="post"/>
      <else>
        <text macro="bibliography-notes"/>
      </else>
    </choose>
  </macro>
  <bibliography hanging-indent="true">
    <sort>
      <key macro="author-bib"/>
      <key macro="title-and-descriptions"/>
      <key macro="source"/>
      <key variable="volume"/>
      <key variable="part-number"/>
      <key variable="event-date"/>
      <key variable="original-date"/>
      <key macro="source-date-issued-or-status"/>
      <key macro="source-archive"/>
    </sort>
    <layout suffix=".">
      <text macro="bibliography-filtered-notes"/>
    </layout>
  </bibliography>
</style>
